.. _monitoring_query_performance:

****************************
Monitoring Query Performance
****************************

This document aims to provide guidance on analyzing query performance through the examination of execution plans. The emphasis is on pinpointing bottlenecks and exploring potential optimization techniques to enhance overall query performance. When delving into query tuning options, the initial step involves a comprehensive analysis of the query plan and execution. The query plan and execution details provide insights into how BLUE processes a query and where the majority of processing time is allocated. 

It's crucial to recognize that performance tuning options vary for each query. Recommendations and tips should be tailored to suit the specifics of individual workloads. Additionally, referring to our :ref:`sql_best_practices` guide is advisable for a deeper understanding of considerations related to data loading and other best practices.

Using the ``DESCRIBE QUERY`` Command
====================================

The :ref:`DESCRIBE QUERY<describe_query>` command provides an instantaneous overview of the current query plan by presenting a real-time depiction of the compiler's execution strategy and performance metrics for the designated query.

For example:

.. code-block:: sql
   
   DESCRIBE SESSION QUERIES SESSION ID  '75b64bd1-f237-4336-8011-3d29239bd9bb';
   
Output:

.. code-block:: none

	+--------+------------+----------+----------------------------------------------------------------------------------------------------+---------------------+------------------------------------+-------------------+-------------------+--------+-------------+----------------+--------------+------------------+---------+-------------+-------------+--------------------+----------------------+--------------+-----------+
	|query_id|query_status|query_type|sql_text                                                                                            |role                 |session_id                          |start_time         |end_time           |duration|time_in_queue|compilation_time|execution_time|total_compute_time|rows_read|rows produced|data produced|data_read_compressed|data_read_uncompressed|client_info   |query_error|
	+--------+------------+----------+----------------------------------------------------------------------------------------------------+---------------------+------------------------------------+-------------------+-------------------+--------+-------------+----------------+--------------+------------------+---------+-------------+-------------+--------------------+----------------------+--------------+-----------+
	|2       |COMPLETE    |USE       |USE POOL SQream                                                                                     |taliar@sqreamtech.com|75b64bd1-f237-4336-8011-3d29239bd9bb|2024-02-06T13:55:32|2024-02-06T13:55:32|74      |0            |40              |0             |0                 |         |             |0            |                    |                      |SQream Node.js|           |
	+--------+------------+----------+----------------------------------------------------------------------------------------------------+---------------------+------------------------------------+-------------------+-------------------+--------+-------------+----------------+--------------+------------------+---------+-------------+-------------+--------------------+----------------------+--------------+-----------+
	|1       |EXECUTING   |SELECT    |SELECT l_returnflag, l_linestatus, Sum(Cast(l_quantity AS BIGINT)) AS sum_qty, Sum(l_extendedprice /|taliar@sqreamtech.com|75b64bd1-f237-4336-8011-3d29239bd9bb|2024-02-06T13:55:22|null               |        |             |485             |              |0                 |         |             |             |                    |                      |SQream Node.js|           |
	|        |            |          |100.0) AS sum_base_price, Sum(l_extendedprice / 100.0 *(1 - l_discount / 100.0)) AS  sum_disc_price,|                     |                                    |                   |                   |        |             |                |              |                  |         |             |             |                    |                      |              |           |
	|        |            |          |Sum(l_extendedprice / 100.0 *(1 - l_discount / 100.0) *(  1  +  l_tax  /  100.0)  )  AS  sum_charge,|                     |                                    |                   |                   |        |             |                |              |                  |         |             |             |                    |                      |              |           |
	|        |            |          |Avg(Cast(l_quantity AS FLOAT)) AS avg_qty, Avg(l_extendedprice / 100.0) AS avg_price, Avg(l_discount|                     |                                    |                   |                   |        |             |                |              |                  |         |             |             |                    |                      |              |           |
	|        |            |          |/ 100.0) AS avg_disc, Count(*) AS count_order FROM lineitem WHERE l_shipdate  <=  '1998-09-16'::date|                     |                                    |                   |                   |        |             |                |              |                  |         |             |             |                    |                      |              |           |
	|        |            |          |GROUP BY l_returnflag, l_linestatus ORDER BY l_returnflag, l_linestatus LIMIT 10000                 |                     |                                    |                   |                   |        |             |                |              |                  |         |             |             |                    |                      |              |           |
	+--------+------------+----------+----------------------------------------------------------------------------------------------------+---------------------+------------------------------------+-------------------+-------------------+--------+-------------+----------------+--------------+------------------+---------+-------------+-------------+--------------------+----------------------+--------------+-----------+

.. code-block:: sql

	DESCRIBE QUERY SESSION ID '75b64bd1-f237-4336-8011-3d29239bd9bb' QUERY ID '1';
	
.. code-block:: none

	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|query_id                              |rtc_name                       |node_id|parent_id|node_type        |elapsed_time|total_compute_time|total_waiting_time|rows_produced|chunks_produced|data_read  |data_written|output      |additional_info|time               |status|
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|1      |-1       |CloudRSend       |0           |0                 |0                 |0            |0              |0          |0           |0           |(single)       |2024-02-06 13:55:22|-1    |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|1      |-1       |CloudRSend       |0.333333333 |0.333333333       |0                 |4            |1              |0          |0           |200316      |(single)       |2024-02-06 13:59:12|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|1      |-1       |CloudRSend       |0           |0                 |0                 |0            |0              |0          |0           |0           |(single)       |2024-02-06 13:55:22|-1    |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|2      |1        |Rechunk          |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|2      |1        |Rechunk          |0.000035751 |0.000035751       |0                 |4            |1              |0          |0           |380         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|2      |1        |Rechunk          |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|3      |2        |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|3      |2        |ReorderInput     |0.000023942 |0.000023942       |0                 |4            |1              |0          |0           |380         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|3      |2        |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|4      |3        |DeferredGather   |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|4      |3        |DeferredGather   |0.001896855 |0.001896855       |0                 |4            |1              |0          |0           |396         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|4      |3        |DeferredGather   |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|5      |4        |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|5      |4        |ReorderInput     |0.000032381 |0.000032381       |0                 |4            |1              |0          |0           |396         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|5      |4        |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|6      |5        |GpuToCpu         |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|6      |5        |GpuToCpu         |0.000031131 |0.000031131       |0                 |4            |1              |0          |0           |16          |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|6      |5        |GpuToCpu         |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|7      |6        |Top              |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|7      |6        |Top              |0.000069197 |0.000069197       |0                 |4            |1              |0          |0           |16          |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|7      |6        |Top              |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|8      |7        |GpuTransform     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|8      |7        |GpuTransform     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|8      |7        |GpuTransform     |0.000064407 |0.000064407       |0                 |4            |1              |0          |0           |16          |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|9      |8        |CpuToGpu         |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|9      |8        |CpuToGpu         |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|9      |8        |CpuToGpu         |0.000051938 |0.000051938       |0                 |4            |1              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|10     |9        |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|10     |9        |ReorderInput     |0.000053502 |0.000053502       |0                 |4            |1              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|10     |9        |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|11     |10       |Rechunk          |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|11     |10       |Rechunk          |0.000076075 |0.000076075       |0                 |4            |1              |0          |0           |380         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|11     |10       |Rechunk          |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|12     |11       |SortMerge        |0           |0                 |0                 |0            |0              |0          |0           |0           |(single)       |2024-02-06 13:55:22|-1    |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|12     |11       |SortMerge        |0.000227857 |0.000227857       |0                 |4            |1              |0          |0           |380         |(single)       |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|12     |11       |SortMerge        |0           |0                 |0                 |0            |0              |0          |0           |0           |(single)       |2024-02-06 13:55:22|-1    |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|13     |12       |ReorderInput     |0.000056243 |0.000056243       |0                 |4            |1              |0          |0           |380         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|13     |12       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|13     |12       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|14     |13       |DeferredGather   |0.002119729 |0.002119729       |0                 |4            |1              |0          |0           |396         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|14     |13       |DeferredGather   |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|14     |13       |DeferredGather   |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|15     |14       |ReorderInput     |0.000156206 |0.000156206       |0                 |4            |1              |0          |0           |396         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|15     |14       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|15     |14       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|16     |15       |GpuToCpu         |0.000198319 |0.000198319       |0                 |4            |1              |0          |0           |220         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|16     |15       |GpuToCpu         |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|16     |15       |GpuToCpu         |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|17     |16       |TakeRowsFromChunk|0.000160585 |0.000160585       |0                 |4            |1              |0          |0           |220         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|17     |16       |TakeRowsFromChunk|0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|17     |16       |TakeRowsFromChunk|0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|18     |17       |Sort             |0.003255393 |0.003255393       |0                 |4            |1              |0          |0           |220         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|18     |17       |Sort             |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|18     |17       |Sort             |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|19     |18       |ReorderInput     |0.000056006 |0.000056006       |0                 |4            |1              |0          |0           |220         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|19     |18       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|19     |18       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|20     |19       |GpuTransform     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|20     |19       |GpuTransform     |0.000321777 |0.000321777       |0                 |4            |1              |0          |0           |220         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|20     |19       |GpuTransform     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|21     |20       |GpuTransform     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|21     |20       |GpuTransform     |0.000171697 |0.000171697       |0                 |4            |1              |0          |0           |328         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|21     |20       |GpuTransform     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|22     |21       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|22     |21       |ReorderInput     |0.000118647 |0.000118647       |0                 |4            |1              |0          |0           |312         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|22     |21       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|23     |22       |Rechunk          |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|23     |22       |Rechunk          |0.000351926 |0.000351926       |0                 |4            |1              |0          |0           |492         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|23     |22       |Rechunk          |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|24     |23       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|24     |23       |ReorderInput     |0.000082175 |0.000082175       |0                 |4            |1              |0          |0           |492         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|24     |23       |ReorderInput     |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|25     |24       |ReduceMerge      |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|25     |24       |ReduceMerge      |1.095113264 |1.095113264       |0                 |4            |1              |0          |0           |492         |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|25     |24       |ReduceMerge      |0           |0                 |0                 |0            |0              |0          |0           |0           |               |2024-02-06 13:59:11|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|26     |25       |GpuToCpu         |0.010310393 |0.010310393       |0                 |320          |80             |0          |0           |39360       |               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|26     |25       |GpuToCpu         |0.035758739 |0.035758739       |0                 |364          |91             |0          |0           |44772       |               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|26     |25       |GpuToCpu         |0.036514671 |0.036514671       |0                 |360          |90             |0          |0           |44280       |               |2024-02-06 13:59:08|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|27     |26       |GpuReduceMerge   |0.001302821 |0.001302821       |0                 |320          |80             |0          |0           |39360       |               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|27     |26       |GpuReduceMerge   |0.003866965 |0.003866965       |0                 |364          |91             |0          |0           |44772       |               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|27     |26       |GpuReduceMerge   |0.003985990 |0.003985990       |0                 |360          |90             |0          |0           |44280       |               |2024-02-06 13:59:08|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|28     |27       |Reduce           |18.28646836 |18.28646836       |0                 |320          |80             |0          |0           |39360       |               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|28     |27       |Reduce           |63.53498770 |63.53498770       |0                 |364          |91             |0          |0           |44772       |               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|28     |27       |Reduce           |61.38216222 |61.38216222       |0                 |360          |90             |0          |0           |44280       |               |2024-02-06 13:59:08|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|29     |28       |GpuTransform     |1.280921043 |1.280921043       |0                 |4563175635   |80             |0          |0           |328548645720|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|29     |28       |GpuTransform     |4.691293153 |4.691293153       |0                 |5157750374   |91             |0          |0           |371358026928|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|29     |28       |GpuTransform     |4.583934178 |4.583934178       |0                 |5128316488   |90             |0          |0           |369238787136|               |2024-02-06 13:59:08|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|30     |29       |Filter           |2.692268061 |2.692268061       |0                 |4563175635   |80             |0          |0           |278353713735|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|30     |29       |Filter           |9.136230794 |9.136230794       |0                 |5128316488   |90             |0          |0           |312827305768|               |2024-02-06 13:59:08|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|30     |29       |Filter           |9.230932045 |9.230932045       |0                 |5157750374   |91             |0          |0           |314622772814|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|31     |30       |GpuTransform     |0.037528004 |0.037528004       |0                 |4609523030   |80             |0          |0           |281180904830|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|31     |30       |GpuTransform     |0.121411898 |0.121411898       |0                 |5180389499   |90             |0          |0           |316003759439|               |2024-02-06 13:59:08|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|31     |30       |GpuTransform     |0.122485370 |0.122485370       |0                 |5210088094   |91             |0          |0           |317815373734|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|32     |31       |CpuToGpu         |29.45859978 |29.45859978       |0                 |4609523030   |80             |0          |0           |276571381800|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|32     |31       |CpuToGpu         |88.50479661 |88.50479661       |0                 |5180389499   |90             |0          |0           |310823369940|               |2024-02-06 13:59:08|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|32     |31       |CpuToGpu         |88.13720536 |88.13720536       |0                 |5210088094   |91             |0          |0           |312605285640|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|33     |32       |Rechunk          |0.003880598 |0.003880598       |0                 |4609523030   |80             |0          |0           |276571381800|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|33     |32       |Rechunk          |0.011210242 |0.011210242       |0                 |5180389499   |90             |0          |0           |310823369940|               |2024-02-06 13:59:08|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|33     |32       |Rechunk          |0.009878635 |0.009878635       |0                 |5210088094   |91             |0          |0           |312605285640|               |2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|34     |33       |ReadParquet      |23.79989737 |23.79989737       |0                 |4609523030   |80             |44604597414|0           |276571381800|public.lineitem|2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|34     |33       |ReadParquet      |60.80870176 |60.80870176       |0                 |5180389499   |90             |50129506986|0           |310823369940|public.lineitem|2024-02-06 13:59:08|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|34     |33       |ReadParquet      |60.32408578 |60.32408578       |0                 |5210088094   |91             |50417111193|0           |312605285640|public.lineitem|2024-02-06 13:59:10|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-5bwlw|35     |34       |LocateFiles      |0           |0                 |0                 |0            |0              |0          |0           |0           |(single)       |2024-02-06 13:55:22|-1    |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-58nkd|35     |34       |LocateFiles      |0.846274306 |0.846274306       |0                 |1796         |1796           |0          |0           |0           |(single)       |2024-02-06 13:58:53|2     |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+
	|75b64bd1-f237-4336-8011-3d29239bd9bb:1|sqream-worker-0-7b6df66c7-rb2zt|35     |34       |LocateFiles      |0           |0                 |0                 |0            |0              |0          |0           |0           |(single)       |2024-02-06 13:55:22|-1    |
	+--------------------------------------+-------------------------------+-------+---------+-----------------+------------+------------------+------------------+-------------+---------------+-----------+------------+------------+---------------+-------------------+------+

Alternatively, you may also :ref:`retrieve the query execution plan output<retrieving_execution_plan_output_using_studio>` using your Workbench.

Understanding the Query Execution Plan Output
=============================================

Both :ref:`describe_query`  and the logged execution plans represents the query plan as a graph hierarchy, with data separated into different columns.

Each row represents a single logical database operation, which is also called a **node** or **chunk producer**. A node reports several metrics during query execution, such as how much data it has read and written, how many chunks and rows, and how much time has elapsed.

Consider the example show_node_info presented above. The source node with ID **#16** (``ParallelReadWorker``), has a parent node ID **#15** (``CpuDecompress``).
   
The last node, also called the sink, has a parent node ID of **-1**, meaning it has no parent. This is typically a node that sends data over the network or into a table.
   
   
.. code-block::
   
   digraph G {
   rankdir=tb;
   ranksep=0.95;
   node[shape=box3d, width=3.0, height=0.6, fontname="Consolas", fillcolor=SteelBlue2, style=filled];
     PushToNetworkQueue [shape=house, fillcolor=SeaGreen1, style=filled];
     
   ReadTable->CpuDecompress;
   CpuDecompress->Rechunk;
   Rechunk->ReorderInput;
   ReorderInput->CpuToGpu;
   CpuToGpu->GpuTransform;
   GpuTransform->GpuDecompress;
   GpuDecompress->GpuTransform2;
   GpuTransform2->Filter;
   Filter->ReorderInput2;
   ReorderInput2->GpuTransform3;
   GpuTransform3->GpuToCpu;
   GpuToCpu->ReorderInput3;
   ReorderInput3->DeferredGather;
   DeferredGather->ReorderInput4;
   ReorderInput4->Rechunk2;
   Rechunk2->PushToNetworkQueue;
       Rechunk2[label="Rechunk"];
       ReorderInput4[label="ReorderInput"];
       ReorderInput3[label="ReorderInput"];
       ReorderInput2[label="ReorderInput"];
       GpuTransform2[label="GpuTransform"];
       GpuTransform3[label="GpuTransform"];
     
     ReadTable [shape=house, style=filled, fillcolor=SeaGreen4];
         
   }
   
When using :ref:`describe_query`, a tabular representation of the currently running statement execution is presented.
See the examples below to understand how the query execution plan is instrumental in identifying bottlenecks and optimizing long-running statements.

Commonly Seen Nodes
-------------------

.. list-table:: Node types
   :widths: auto
   :header-rows: 1
   
   * - Column name
     - Execution location
     - Description
   * - ``CpuDecompress``
     - CPU
     - Decompression operation, common for longer ``TEXT`` types
   * - ``CpuLoopJoin``
     - CPU
     - A non-indexed nested loop join, performed on the CPU
   * - ``CpuReduce``
     - CPU
     - A reduce process performed on the CPU, primarily with ``DISTINCT`` aggregates (e.g. ``COUNT(DISTINCT ...)``)
   * - ``CpuToGpu``, ``GpuToCpu``
     - 
     - An operation that moves data to or from the GPU for processing
   * - ``CpuTransform``
     - CPU
     - A transform operation performed on the CPU, usually a :ref:`scalar function<scalar_functions>`
   * - ``DeferredGather``
     - CPU
     - Merges the results of GPU operations with a result set
   * - ``Distinct``
     - GPU
     - Removes duplicate rows (usually as part of the ``DISTINCT`` operation)
   * - ``Distinct_Merge``
     - CPU
     - The merge operation of the ``Distinct`` operation
   * - ``Filter``
     - GPU
     - A filtering operation, such as a ``WHERE`` or ``JOIN`` clause
   * - ``GpuDecompress``
     - GPU
     - Decompression operation
   * - ``GpuReduceMerge``
     - GPU
     - An operation to optimize part of the merger phases in the GPU
   * - ``GpuTransform``
     - GPU
     - A transformation operation such as a type cast or :ref:`scalar function<scalar_functions>`
   * - ``LocateFiles``
     - CPU
     - Validates external file paths for foreign data wrappers, expanding directories and GLOB patterns
   * - ``LoopJoin``
     - GPU
     - A non-indexed nested loop join, performed on the GPU
   * - ``ParseCsv``
     - CPU
     - A CSV parser, used after ``ReadFiles`` to convert the CSV into columnar data
   * - ``PushToNetworkQueue``
     - CPU
     - Sends result sets to a client connected over the network
   * - ``ReadFiles``
     - CPU
     - Reads external flat-files
   * - ``ReadTable``
     - CPU
     - Reads data from a standard table stored on disk
   * - ``Rechunk``
     - 
     - Reorganize multiple small :ref:`chunks<chunks_and_extents>` into a full chunk. Commonly found after ``JOIN`` operations 
   * - ``Reduce``
     - GPU
     - A reduction operation, such as a ``GROUP BY``
   * - ``ReduceMerge``
     - GPU
     - A merge operation of a reduction operation, helps operate on larger-than-RAM data
   * - ``ReorderInput``
     - 
     - Change the order of arguments in preparation for the next operation
   * - ``SeparatedGather``
     - GPU
     - Gathers additional columns for the result
   * - ``Sort``
     - GPU
     - Sort operation
   * - ``TakeRowsFromChunk``
     - 
     - Take the first N rows from each chunk, to optimize ``LIMIT`` when used alongside ``ORDER BY``
   * - ``Top``
     - 
     - Limits the input size, when used with ``LIMIT`` (or its alias ``TOP``)
   * - ``UdfTransform``
     - CPU
     - Executes a :ref:`user defined function<python_functions>`
   * - ``UnionAll``
     -
     - Combines two sources of data when ``UNION ALL`` is used
   * - ``Window``
     - GPU
     - Executes a non-ranking :ref:`window function<window_functions>`
   * - ``WindowRanking``
     - GPU
     - Executes a ranking :ref:`window function<window_functions>`
   * - ``WriteTable``
     - CPU 
     - Writes the result set to a standard table stored on disk

.. tip:: The full list of nodes appears in the :ref:`Node types table<node_types>`, as part of the :ref:`describe_query` reference.

Examples
========

In general, looking at the top three longest running nodes (as is detailed in the ``timeSum`` column) can indicate the biggest bottlenecks.
In the following examples you will learn how to identify and solve some common issues.

Identifying the Offending Nodes
---------------------------------

1. Run a query.
     
For example, a query from the TPC-H benchmark:

.. code-block:: postgres
      
      SELECT o_year,
             SUM(CASE WHEN nation = 'BRAZIL' THEN volume ELSE 0 END) / SUM(volume) AS mkt_share
      FROM (SELECT datepart(YEAR,o_orderdate) AS o_year,
                   l_extendedprice*(1 - l_discount / 100.0) AS volume,
                   n2.n_name AS nation
            FROM lineitem
              JOIN part ON p_partkey = CAST (l_partkey AS INT)
              JOIN orders ON l_orderkey = o_orderkey
              JOIN customer ON o_custkey = c_custkey
              JOIN nation n1 ON c_nationkey = n1.n_nationkey
              JOIN region ON n1.n_regionkey = r_regionkey
              JOIN supplier ON s_suppkey = l_suppkey
              JOIN nation n2 ON s_nationkey = n2.n_nationkey
            WHERE o_orderdate BETWEEN '1995-01-01' AND '1996-12-31') AS all_nations
      GROUP BY o_year
      ORDER BY o_year;

2. Observe the execution information by using the foreign table, or use ``DESCRIBE QUERY``.
   
   This statement is made up of 199 nodes, starting from a ``ReadTable``, and finishes by returning only 2 results to the client.
   
   The execution below has been shortened, but note the highlighted rows for ``LoopJoin``:
   
.. code-block:: sql
   
      SELECT message FROM logs WHERE message_type_id = 200 LIMIT 1;
      message                                                                                  
      -----------------------------------------------------------------------------------------
      SELECT o_year,                                                                           
             SUM(CASE WHEN nation = 'BRAZIL' THEN volume ELSE 0 END) / SUM(volume) AS mkt_share
       : FROM (SELECT datepart(YEAR,o_orderdate) AS o_year,
       :              l_extendedprice*(1 - l_discount / 100.0) AS volume,
       :              n2.n_name AS nation
       :       FROM lineitem
       :         JOIN part ON p_partkey = CAST (l_partkey AS INT)
       :         JOIN orders ON l_orderkey = o_orderkey
       :         JOIN customer ON o_custkey = c_custkey
       :         JOIN nation n1 ON c_nationkey = n1.n_nationkey
       :         JOIN region ON n1.n_regionkey = r_regionkey
       :         JOIN supplier ON s_suppkey = l_suppkey
       :         JOIN nation n2 ON s_nationkey = n2.n_nationkey
       :       WHERE o_orderdate BETWEEN '1995-01-01' AND '1996-12-31') AS all_nations
       : GROUP BY o_year
       : ORDER BY o_year
       : 1,PushToNetworkQueue  ,2,1,2,2020-09-04 18:32:50,-1,,,,0.27
       : 2,Rechunk             ,2,1,2,2020-09-04 18:32:50,1,,,,0.00
       : 3,SortMerge           ,2,1,2,2020-09-04 18:32:49,2,,,,0.00
       : 4,GpuToCpu            ,2,1,2,2020-09-04 18:32:49,3,,,,0.00
       : 5,Sort                ,2,1,2,2020-09-04 18:32:49,4,,,,0.00
       : 6,ReorderInput        ,2,1,2,2020-09-04 18:32:49,5,,,,0.00
       : 7,GpuTransform        ,2,1,2,2020-09-04 18:32:49,6,,,,0.00
       : 8,CpuToGpu            ,2,1,2,2020-09-04 18:32:49,7,,,,0.00
       : 9,Rechunk             ,2,1,2,2020-09-04 18:32:49,8,,,,0.00
       : 10,ReduceMerge         ,2,1,2,2020-09-04 18:32:49,9,,,,0.03
       : 11,GpuToCpu            ,6,3,2,2020-09-04 18:32:49,10,,,,0.00
       : 12,Reduce              ,6,3,2,2020-09-04 18:32:49,11,,,,0.64
       [...]
       : 49,LoopJoin            ,182369485,7,26052783,2020-09-04 18:32:36,48,1915MB,1915MB,inner,4.94
       [...]
       : 98,LoopJoin            ,182369485,12,15197457,2020-09-04 18:32:16,97,2191MB,2191MB,inner,5.01
       [...]
       : 124,LoopJoin            ,182369485,8,22796185,2020-09-04 18:32:03,123,3064MB,3064MB,inner,6.73
       [...]
       : 150,LoopJoin            ,182369485,10,18236948,2020-09-04 18:31:47,149,12860MB,12860MB,inner,23.62
       [...]
       : 199,ReadTable           ,20000000,1,20000000,2020-09-04 18:30:33,198,0MB,,public.part,0.83
   
Queries with Large Result Sets
------------------------------

When queries have large result sets, you may see a node called ``DeferredGather``.
This gathering occurs when the result set is assembled, in preparation for sending it to the client.

Identifying the Offending Nodes
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1. Run a query.
     
   For example, a modified query from the TPC-H benchmark:

.. code-block:: sql
      
      SELECT s.*,
             l.*,
             r.*,
             n1.*,
             n2.*,
             p.*,
             o.*,
             c.*
      FROM lineitem l
        JOIN part p ON p_partkey = CAST (l_partkey AS INT)
        JOIN orders o ON l_orderkey = o_orderkey
        JOIN customer c ON o_custkey = c_custkey
        JOIN nation n1 ON c_nationkey = n1.n_nationkey
        JOIN region r ON n1.n_regionkey = r_regionkey
        JOIN supplier s ON s_suppkey = l_suppkey
        JOIN nation n2 ON s_nationkey = n2.n_nationkey
      WHERE r_name = 'AMERICA'
      AND   o_orderdate BETWEEN '1995-01-01' AND '1996-12-31'
	  ;

2. Observe the execution information by using the foreign table, or use ``DESCRIBE QUERY``
   
   This statement is made up of 221 nodes, containing 8 ``ReadTable`` nodes, and finishes by returning billions of results to the client.
   
   The execution below has been shortened, but note the highlighted rows for ``DeferredGather``:
   
.. code-block:: sql
   
    SELECT show_node_info(494);
	
Output:

.. code-block:: none
	
      stmt_id | node_id | node_type            | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read    | write | comment         | timeSum
      --------+---------+----------------------+-----------+--------+-------------------+---------------------+----------------+---------+-------+-----------------+--------
          494 |       1 | PushToNetworkQueue   |    242615 |      1 |            242615 | 2020-09-04 19:07:55 |             -1 |         |       |                 |    0.36
          494 |       2 | Rechunk              |    242615 |      1 |            242615 | 2020-09-04 19:07:55 |              1 |         |       |                 |       0
          494 |       3 | ReorderInput         |    242615 |      1 |            242615 | 2020-09-04 19:07:55 |              2 |         |       |                 |       0
          494 |       4 | DeferredGather       |    242615 |      1 |            242615 | 2020-09-04 19:07:55 |              3 |         |       |                 |    0.16
          [...]
          494 |     166 | DeferredGather       |   3998730 |     39 |            102531 | 2020-09-04 19:07:47 |            165 |         |       |                 |   21.75
          [...]
          494 |     194 | DeferredGather       |    133241 |     20 |              6662 | 2020-09-04 19:07:03 |            193 |         |       |                 |    0.41
          [...]
          494 |     221 | ReadTable            |  20000000 |     20 |           1000000 | 2020-09-04 19:07:01 |            220 | 20MB    |       | public.part     |     0.1
  
When you see ``DeferredGather`` operations taking more than a few seconds, that's a sign that you're selecting too much data.

In this case, the DeferredGather with node ID 166 took over 21 seconds.
   
3. Modify the statement to see the difference
   Altering the select clause to be more restrictive will reduce the deferred gather time back to a few milliseconds.
   
.. code-block:: sql
      
   SELECT DATEPART(year, o_orderdate) AS o_year,
          l_extendedprice * (1 - l_discount / 100.0) as volume,
          n2.n_name as nation
   FROM ...

Common Solutions for Reducing Gather Time
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Reduce the effect of the preparation time. Avoid selecting unnecessary columns (``SELECT * FROM...``), or reduce the result set size by using more filters.

Inefficient Filtering
---------------------

When running statements, BLUE tries to avoid reading data that is not needed for the statement by skipping chunks.

If statements do not include efficient filtering, BLUE will read a lot of data off disk.
In some cases, you need the data and there's nothing to do about it. However, if most of it gets pruned further down the line, it may be efficient to skip reading the data altogether by using the :ref:`metadata<metadata_system>`.

Identifying the Situation
^^^^^^^^^^^^^^^^^^^^^^^^^

We consider the filtering to be inefficient when the ``Filter`` node shows that the number of rows processed is less
than a third of the rows passed into it by the ``ReadTable`` node.

For example:

1. Run a query.
     
   In this example, we execute a modified query from the TPC-H benchmark.
   Our ``lineitem`` table contains 600,037,902 rows.

   .. code-block:: postgres
      
      SELECT o_year,
             SUM(CASE WHEN nation = 'BRAZIL' THEN volume ELSE 0 END) / SUM(volume) AS mkt_share
      FROM (SELECT datepart(YEAR,o_orderdate) AS o_year,
                   l_extendedprice*(1 - l_discount / 100.0) AS volume,
                   n2.n_name AS nation
            FROM lineitem
              JOIN part ON p_partkey = CAST (l_partkey AS INT)
              JOIN orders ON l_orderkey = o_orderkey
              JOIN customer ON o_custkey = c_custkey
              JOIN nation n1 ON c_nationkey = n1.n_nationkey
              JOIN region ON n1.n_regionkey = r_regionkey
              JOIN supplier ON s_suppkey = l_suppkey
              JOIN nation n2 ON s_nationkey = n2.n_nationkey
            WHERE r_name = 'AMERICA'
            AND   lineitem.l_quantity = 3
            AND   o_orderdate BETWEEN '1995-01-01' AND '1996-12-31') AS all_nations
      GROUP BY o_year
      ORDER BY o_year;

2. Observe the execution information by using the foreign table, or use ``DESCRIBE QUERY``
   
   The execution below has been shortened.
   
   .. code-block:: psql
   
      SELECT show_node_info(559);
	  
   .. code-block:: none	  
	  
      stmt_id | node_id | node_type            | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read   | write | comment         | timeSum
      --------+---------+----------------------+-----------+--------+-------------------+---------------------+----------------+--------+-------+-----------------+--------
          559 |       1 | PushToNetworkQueue   |         2 |      1 |                 2 | 2020-09-07 11:12:01 |             -1 |        |       |                 |    0.28
          559 |       2 | Rechunk              |         2 |      1 |                 2 | 2020-09-07 11:12:01 |              1 |        |       |                 |       0
          559 |       3 | SortMerge            |         2 |      1 |                 2 | 2020-09-07 11:12:01 |              2 |        |       |                 |       0
          559 |       4 | GpuToCpu             |         2 |      1 |                 2 | 2020-09-07 11:12:01 |              3 |        |       |                 |       0
      [...]
          559 |     189 | Filter               |  12007447 |     12 |           1000620 | 2020-09-07 11:12:00 |            188 |        |       |                 |     0.3
          559 |     190 | GpuTransform         | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            189 |        |       |                 |    0.02
          559 |     191 | GpuDecompress        | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            190 |        |       |                 |    0.16
          559 |     192 | GpuTransform         | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            191 |        |       |                 |    0.02
          559 |     193 | CpuToGpu             | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            192 |        |       |                 |    1.47
          559 |     194 | ReorderInput         | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            193 |        |       |                 |       0
          559 |     195 | Rechunk              | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            194 |        |       |                 |       0
          559 |     196 | CpuDecompress        | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            195 |        |       |                 |       0
          559 |     197 | ReadTable            | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            196 | 7587MB |       | public.lineitem |     0.1
      [...]
          559 |     208 | Filter               |    133241 |     20 |              6662 | 2020-09-07 11:11:57 |            207 |        |       |                 |    0.01
          559 |     209 | GpuTransform         |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            208 |        |       |                 |    0.02
          559 |     210 | GpuDecompress        |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            209 |        |       |                 |    0.03
          559 |     211 | GpuTransform         |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            210 |        |       |                 |       0
          559 |     212 | CpuToGpu             |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            211 |        |       |                 |    0.01
          559 |     213 | ReorderInput         |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            212 |        |       |                 |       0
          559 |     214 | Rechunk              |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            213 |        |       |                 |       0
          559 |     215 | CpuDecompress        |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            214 |        |       |                 |       0
          559 |     216 | ReadTable            |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            215 | 20MB   |       | public.part     |       0
      
   * 
      The ``Filter`` on line 9 has processed 12,007,447 rows, but the output of ``ReadTable`` on ``public.lineitem`` 
      on line 17 was 600,037,902 rows. This means that it has filtered out 98% (:math:`1 - \dfrac{600037902}{12007447} = 98\%`)
      of the data, but the entire table was read.
      
   * 
      The ``Filter`` on line 19 has processed 133,000 rows, but the output of ``ReadTable`` on ``public.part`` 
      on line 27 was 20,000,000 rows.  This means that it has filtered out >99% (:math:`1 - \dfrac{133241}{20000000} = 99.4\%`)
      of the data, but the entire table was read. However, this table is small enough that we can ignore it.
   
3. Modify the statement to see the difference
   Altering the statement to have a ``WHERE`` condition on the clustered ``l_orderkey`` column of the ``lineitem`` table will help BLUE skip reading the data.
   
   .. code-block:: sql
      :emphasize-lines: 15
      
      SELECT o_year,
             SUM(CASE WHEN nation = 'BRAZIL' THEN volume ELSE 0 END) / SUM(volume) AS mkt_share
      FROM (SELECT datepart(YEAR,o_orderdate) AS o_year,
                   l_extendedprice*(1 - l_discount / 100.0) AS volume,
                   n2.n_name AS nation
            FROM lineitem
              JOIN part ON p_partkey = CAST (l_partkey AS INT)
              JOIN orders ON l_orderkey = o_orderkey
              JOIN customer ON o_custkey = c_custkey
              JOIN nation n1 ON c_nationkey = n1.n_nationkey
              JOIN region ON n1.n_regionkey = r_regionkey
              JOIN supplier ON s_suppkey = l_suppkey
              JOIN nation n2 ON s_nationkey = n2.n_nationkey
            WHERE r_name = 'AMERICA'
            AND   lineitem.l_orderkey > 4500000
            AND   o_orderdate BETWEEN '1995-01-01' AND '1996-12-31') AS all_nations
      GROUP BY o_year
      ORDER BY o_year;

   .. code-block:: sql
      :linenos:
      :emphasize-lines: 5,13
      
      SELECT show_node_info(586);
	  
   .. code-block:: none	  
	  
      stmt_id | node_id | node_type            | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read   | write | comment         | timeSum
      --------+---------+----------------------+-----------+--------+-------------------+---------------------+----------------+--------+-------+-----------------+--------
      [...]
          586 |     190 | Filter               | 494621593 |      8 |          61827699 | 2020-09-07 13:20:45 |            189 |        |       |                 |    0.39
          586 |     191 | GpuTransform         | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            190 |        |       |                 |    0.03
          586 |     192 | GpuDecompress        | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            191 |        |       |                 |    0.26
          586 |     193 | GpuTransform         | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            192 |        |       |                 |    0.01
          586 |     194 | CpuToGpu             | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            193 |        |       |                 |    1.86
          586 |     195 | ReorderInput         | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            194 |        |       |                 |       0
          586 |     196 | Rechunk              | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            195 |        |       |                 |       0
          586 |     197 | CpuDecompress        | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            196 |        |       |                 |       0
          586 |     198 | ReadTable            | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            197 | 6595MB |       | public.lineitem |    0.09
      [...]
   In this example, the filter processed 494,621,593 rows, while the output of ``ReadTable`` on ``public.lineitem`` 
   was 494,927,872 rows. This means that it has filtered out all but 0.01% (:math:`1 - \dfrac{494621593}{494927872} = 0.01\%`)
   of the data that was read.
   
   The metadata skipping has performed very well, and has pre-filtered the data for us by pruning unnecessary chunks.
      
Common Solutions for Improving Filtering
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* Use :ref:`clustering keys and naturally ordered data<data_clustering>` in your filters.
* Avoid full table scans when possible

Identifying the Situation
^^^^^^^^^^^^^^^^^^^^^^^^^

This is easily identifiable - when the amount of average of rows in a chunk is small, following a ``Filter`` operation.
Consider this execution plan:

.. code-block:: psql
   
   SELECT show_node_info(30);
   
.. code-block:: none

   stmt_id | node_id | node_type         | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read  | write | comment    | timeSum
   --------+---------+-------------------+-----------+--------+-------------------+---------------------+----------------+-------+-------+------------+--------
   [...]
        30 |      38 | Filter            |     18160 |     74 |               245 | 2020-09-10 12:17:09 |             37 |       |       |            |   0.012
   [...]
        30 |      44 | ReadTable         |  77000000 |     74 |           1040540 | 2020-09-10 12:17:09 |             43 | 277MB |       | public.dim |   0.058

The table was read entirely - 77 million rows into 74 chunks.
The filter node reduced the output to just 18,160 relevant rows, but they're distributed across the original 74 chunks.
All of these rows could fit in one single chunk, instead of spanning 74 rather sparse chunks.

Performance of unsorted data in joins
-------------------------------------

When data is not well-clustered or naturally ordered, a join operation can take a long time. 

Identifying the Situation
^^^^^^^^^^^^^^^^^^^^^^^^^

When running a statement, inspect it with :ref:`describe_query`. If you see ``Join`` and ``DeferredGather`` among your 
top five longest running nodes, there is a potential issue.
In this case, we're also interested in the number of chunks produced by these nodes.

Consider this execution plan:

.. code-block:: sql

   
   SELECT show_node_info(30);
   
.. code-block:: none
   :emphasize-lines: 6,11

   stmt_id | node_id | node_type         | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read  | write | comment    | timeSum
   --------+---------+-------------------+-----------+--------+-------------------+---------------------+----------------+-------+-------+------------+--------
   [...]
        30 |      13 | ReorderInput      | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             12 |       |       |            |   4.681
        30 |      14 | DeferredGather    | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             13 |       |       |            |  29.901
        30 |      15 | ReorderInput      | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             14 |       |       |            |   3.053
        30 |      16 | GpuToCpu          | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             15 |       |       |            |   5.798
        30 |      17 | ReorderInput      | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             16 |       |       |            |   2.899
        30 |      18 | ReorderInput      | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             17 |       |       |            |   3.695
        30 |      19 | Join              | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             18 |       |       | inner      |  22.745
   [...]
        30 |      38 | Filter            |     18160 |     74 |               245 | 2020-09-10 12:17:09 |             37 |       |       |            |   0.012
   [...]
        30 |      44 | ReadTable         |  77000000 |     74 |           1040540 | 2020-09-10 12:17:09 |             43 | 277MB |       | public.dim |   0.058

* ``Join`` is the node that matches rows from both table relations.
* ``DeferredGather`` gathers the required column chunks to decompress
Pay special attention to the volume of data removed by the ``Filter`` node.
The table was read entirely - 77 million rows into 74 chunks.
The filter node reduced the output to just 18,160 relevant rows, but they're distributed across the original 74 chunks.
All of these rows could fit in one single chunk, instead of spanning 74 rather sparse chunks.

Manual Join Reordering
----------------------

When joining multiple tables, you may wish to change the join order to join the smallest tables first.

Identifying the situation
^^^^^^^^^^^^^^^^^^^^^^^^^

When joining more than two tables, the ``Join`` nodes will be the most time-consuming nodes.

Changing the Join Order
^^^^^^^^^^^^^^^^^^^^^^^

Always prefer to join the smallest tables first.

.. note:: 
   
   We consider small tables to be tables that only retain a small amount of rows after conditions
   are applied. This bears no direct relation to the amount of total rows in the table.

Changing the join order can reduce the query runtime significantly. In the examples below, we reduce the time
from 27.3 seconds to just 6.4 seconds.

.. code-block:: postgres
   :caption: Original query
   
   -- This variant runs in 27.3 seconds
   SELECT SUM(l_extendedprice / 100.0*(1 - l_discount / 100.0)) AS revenue,
          c_nationkey
   FROM lineitem --6B Rows, ~183GB
     JOIN orders --1.5B Rows, ~55GB 
     ON   l_orderkey = o_orderkey
     JOIN customer --150M Rows, ~12GB
     ON   c_custkey = o_custkey
     
   WHERE c_nationkey = 1
         AND   o_orderdate >= DATE '1993-01-01'
         AND   o_orderdate < '1994-01-01'
         AND   l_shipdate >= '1993-01-01'
         AND   l_shipdate <= dateadd(DAY,122,'1994-01-01')
   GROUP BY c_nationkey

.. code-block:: postgres
   :caption: Modified query with improved join order
   
   -- This variant runs in 6.4 seconds
   SELECT SUM(l_extendedprice / 100.0*(1 - l_discount / 100.0)) AS revenue,
          c_nationkey
   FROM orders --1.5B Rows, ~55GB 
     JOIN customer --150M Rows, ~12GB
     ON   c_custkey = o_custkey
     JOIN lineitem --6B Rows, ~183GB
     ON   l_orderkey = o_orderkey
     
   WHERE c_nationkey = 1
         AND   o_orderdate >= DATE '1993-01-01'
         AND   o_orderdate < '1994-01-01'
         AND   l_shipdate >= '1993-01-01'
         AND   l_shipdate <= dateadd(DAY,122,'1994-01-01')
   GROUP BY c_nationkey

Further Reading
===============

See our :ref:`sql_best_practices` guide for more information about query optimization and data loading considerations.