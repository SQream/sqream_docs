.. _audit_log:

*****************
AUDIT LOG
*****************
The **AUDIT LOG** page includes the following sections:

.. contents::
   :local:
   :depth: 1

Overview
====================
The ``AUDITLOG`` command is used for investigating historic events captured by your system, and is designed for tracking user activity and for incident response. The Audit Log feature records executed SQL statements and login and logout events.

Syntax
====================
The following is the ``AUDITLOG`` syntax:

.. code-block:: console

   AUDITLOG
   [ TIMEFRAME FROM <start_date_time> TO <end_date_time> ]
   [ USERNAME IN ( <username1>,..., <usernameN>) ] 
   [ SESSIONID IN ( <session-id1>,..., <session-idN>) ] 
   [ QUERYID IN ( <query-id1>,..., <query-idN>) ]
   [ STATUS IN ( <status1>,..., <statusN>) ]
   [ Category IN ( <category1>,..., <categoryN>) ]
   [ ADDITONALDETAILS LIKE <%additional_details%> ]
   [ ERRORDETAILS LIKE <%error_details%> ]

Filters
====================
The following table shows the ``AUDITLOG`` filters:

+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+
| **Parameter Name**                                           | **Parameter Value** | **Description**                                                                             | **Type**          |
+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+
| TIMEFRAME FROM <start_date_time> TO <end_date_time>          | YYYY-MM-DD HH:MM:SS | Optional parameter for specifying a DATE or DATE TIME filter                                | DATE or DATE TIME |
+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+
| USERNAME IN ( <username1>,..., <usernameN>)                  | username            | Optional parameter for specifying usernames filter, values should be comma separated        | TEXT              |
+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+
| SESSIONID IN ( <session-id1>,..., <session-idN>)             | session_id          | Optional parameter for specifying sessions filter, values should be comma separated         | TEXT              |
+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+
| QUERYID IN ( <query-id1>,..., <query-idN>)                   | query_id            | Optional parameter for specifying queries filter, values should be comma separated          | TEXT              |
+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+
| STATUS IN ( <status1>,..., <statusN>)                        | status              | Optional parameter for specifying event statuses filter, values should be comma separated.  | TEXT              |
|                                                              |                     |                                                                                             |                   |
|                                                              |                     | Possible values include:                                                                    |                   |
|                                                              |                     |                                                                                             |                   |
|                                                              |                     | * EXECUTION_SUCCEED                                                                         |                   |
|                                                              |                     | * EXECUTION_FAILED                                                                          |                   | 
|                                                              |                     | * COMPILATION_SUCCEED                                                                       |                   |
|                                                              |                     | * COMPILATION_FAILED                                                                        |                   |
|                                                              |                     | * Failed                                                                                    |                   |
|                                                              |                     | * New                                                                                       |                   |
|                                                              |                     | * Closed                                                                                    |                   |
|                                                              |                     | * Active                                                                                    |                   |
+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+
| Category IN ( <category1>,..., <categoryN>)                  | category            | Optional parameter for specifying event categories filter, values should be comma separated.| TEXT              |
|                                                              |                     |                                                                                             |                   |
|                                                              |                     | Possible values include:                                                                    |                   |
|                                                              |                     |                                                                                             |                   |
|                                                              |                     | * SESSION                                                                                   |                   |
|                                                              |                     | * SELECT                                                                                    |                   | 
|                                                              |                     | * DESCRIBE                                                                                  |                   |
|                                                              |                     | * DDL                                                                                       |                   |
+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+
| ADDITONALDETAILS LIKE <%additional_details%>                 | additional_details  | Optional parameter for specifying event additional details filter. Wildcards may be used.   | TEXT              |
+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+
| ERRORDETAILS LIKE <%error_details%>                          | error_details       | Optional parameter for specifying event error details filter. Wildcards may be used.        | TEXT              |
+--------------------------------------------------------------+---------------------+---------------------------------------------------------------------------------------------+-------------------+

Examples
====================
This section shows the following ``AUDITLOG`` examples:

.. contents::
   :local:
   :depth: 1

Example 1 - AUDITLOG
-----------------------
The following is the ``AUDITLOG`` command:

.. code-block:: console

   AUDITLOG;
	  
The following is the output of the ``AUDITLOG`` command:

.. code-block:: console

   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------+----------------+
   | id      | time_stamp      | last_update      | username      | session_id                            | query_id      | client_ip_address      | client_version      | status            | category      | additional_details                                        | error_details                                 | tenant_id      |
   +=========+=================+==================+===============+=======================================+===============+========================+=====================+===================+===============+===========================================================+===============================================+================+
   |         | 6/28/2022 12:09 | null             | sqream        | b578eebd-9a52-4a9b-b80b-05fa9dfe9864  |               |                        |                     | Active            | SESSION       |                                                           |                                               | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------+----------------+
   |         | 6/28/2022 12:10 | null             | sqream        | ae7459b2-aaba-4347-ae82-fb5647d0afb7  |               |                        |                     | Active            | SESSION       |                                                           |                                               | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------+----------------+
   | 1       | 6/28/2022 12:10 | null             | sqream        | ae7459b2-aaba-4347-ae82-fb5647d0afb7  | 1             |                        |                     | EXECUTION_FAILED  | SELECT        | select * from sqream_catalog.roles where name = 'sqream'  |                                               | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------+----------------+
   |         | 6/28/2022 12:11 | null             | sqream        | 0c486a8f-b605-4b93-8898-8f6848a9d56f  |               | 192.168.4.89           | SQream JDBC v0.1.33 | Active            | SESSION       |                                                           |                                               | tenant         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------+----------------+
   | 1       | 6/28/2022 12:11 | null             | sqream        | 0c486a8f-b605-4b93-8898-8f6848a9d56f  | 1             | 192.168.4.89           | SQream JDBC v0.1.33 | EXECUTION_SUCCEED | SELECT        | select * from nba;                                        |                                               | tenant         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------+----------------+
   |         | 6/28/2022 12:11 | null             | sqream        | cbec0cb7-2bbc-48f8-b4e1-37fd575e7891  |               |                        |                     | Active            | SESSION       |                                                           |                                               |                |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------+----------------+

Example 2 - AUDITLOG_TIMEFRAME_FROM
-----------------------
The following is the ``AUDITLOG`` command using the ``TIMEFRAME_FROM`` filter:

.. code-block:: console

  AUDITLOG TIMEFRAME FROM '2022-06-28 12:00:00' TO '2022-06-28 13:00:00';

The following is the output of the ``AUDITLOG`` command using the ``TIMEFRAME_FROM`` filter:

.. code-block:: console

   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   | id      | time_stamp      | last_update      | username      | session_id                            | query_id      | client_ip_address      | client_version      | status            | category      | additional_details                                        | error_details                                                                                                                                       | tenant_id      |
   +=========+=================+==================+===============+=======================================+===============+========================+=====================+===================+===============+===========================================================+=====================================================================================================================================================+================+
   |         | 6/28/2022 12:09 | null             | sqream        | b578eebd-9a52-4a9b-b80b-05fa9dfe9864  |               |                        |                     | Active            | SESSION       |                                                           |                                                                                                                                                     | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   |         | 6/28/2022 12:10 | null             | sqream        | ae7459b2-aaba-4347-ae82-fb5647d0afb7  |               |                        |                     | Active            | SESSION       |                                                           |                                                                                                                                                     | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   | 1       | 6/28/2022 12:10 | null             | sqream        | ae7459b2-aaba-4347-ae82-fb5647d0afb7  | 1             |                        |                     | EXECUTION_FAILED  | SELECT        | select * from sqream_catalog.roles where name = 'sqream'  |                                                                                                                                                     | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   |         | 6/28/2022 12:11 | null             | sqream        | 0c486a8f-b605-4b93-8898-8f6848a9d56f  |               | 192.168.4.89           | SQream JDBC v0.1.33 | Active            | SESSION       |                                                           |                                                                                                                                                     | tenant         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   | 1       | 6/28/2022 12:11 | null             | sqream        | 0c486a8f-b605-4b93-8898-8f6848a9d56f  | 1             | 192.168.4.89           | SQream JDBC v0.1.33 | EXECUTION_SUCCEED | SELECT        | select * from nba;                                        |                                                                                                                                                     | tenant         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   |         | 6/28/2022 12:11 | null             | sqream        | cbec0cb7-2bbc-48f8-b4e1-37fd575e7891  |               |                        |                     | Active            | SESSION       |                                                           |                                                                                                                                                     | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   | 1       | 6/28/2022 12:11 | null             | sqream        | cbec0cb7-2bbc-48f8-b4e1-37fd575e7891  | 1             |                        |                     | EXECUTION_FAILED  | SELECT        | select * from sqream_catalog.roles where name = 'sqream'  |                                                                                                                                                     | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   |         | 6/28/2022 12:12 | null             |               | 8d52852f-197a-4d4f-8394-04d5e60f8cfa  |               |                        |                     | Failed            | SESSION       |                                                           | Error in compilation process: : "Login failure: role '' doesn't exist" (sqream::Exception "connect") From: "cpp/planner/common/Compiler.cpp:104"    | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   |         | 6/28/2022 12:23 | null             | sqream        | 5fa96753-24b5-4e36-b26e-9c5a35ff7a2d  |               |                        |                     | Active            | SESSION       |                                                           |                                                                                                                                                     | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   | 1       | 6/28/2022 12:23 | null             | sqream        | 5fa96753-24b5-4e36-b26e-9c5a35ff7a2d  | 1             |                        |                     | EXECUTION_FAILED  | SELECT        | select * from sqream_catalog.roles where name = 'sqream'  |                                                                                                                                                     | sqream         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   |         | 6/28/2022 12:54 | null             | sqream        | a42be0ac-d9ea-44fd-a187-5ded36057f0d  |               | 192.168.4.89           | SQream JDBC v0.1.33 | Active            | SESSION       |                                                           |                                                                                                                                                     | tenant         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   | 1       | 6/28/2022 12:54 | null             | sqream        | a42be0ac-d9ea-44fd-a187-5ded36057f0d  | 1             | 192.168.4.89           | SQream JDBC v0.1.33 | EXECUTION_SUCCEED | SELECT        | select * from nba;                                        |                                                                                                                                                     | tenant         |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+-------------------+---------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------------+
   
Example 3 - AUDITLOG_USERNAME
-----------------------
The following is the ``AUDITLOG`` command using the ``USERNAME`` filter:

.. code-block:: console

   AUDITLOG USERNAME in ('sqream', 'dbuser1');
   
The following is the output of the ``AUDITLOG`` command using the ``USERNAME`` filter:

.. code-block:: console

   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+--------------------+---------------+----------------------------------------------------------------------+--------------------+
   | id      | time_stamp      | last_update      | username      | session_id                            | query_id      | client_ip_address      | client_version      | status             | category      | additional_details                                                   | error_details      |
   +=========+=================+==================+===============+=======================================+===============+========================+=====================+====================+===============+======================================================================+====================+
   |         | 6/30/2022 10:59 | null             | dbuser1       | 920ca5ec-c34f-443d-a131-8cd296a73c9c  |               |                        |                     | Active             | SESSION       |                                                                      |                    |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+--------------------+---------------+----------------------------------------------------------------------+--------------------+
   | 1       | 6/30/2022 10:59 | null             | dbuser1       | 920ca5ec-c34f-443d-a131-8cd296a73c9c  | 1             |                        |                     | EXECUTION_SUCCEED  | UNKNOWN       | SET sessionTag='webui'                                               |                    |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+--------------------+---------------+----------------------------------------------------------------------+--------------------+
   | 2       | 6/30/2022 10:59 | null             | dbuser1       | 772623e4-0bb6-4c0d-b50f-64990b4615c4  | 2             |                        |                     | EXECUTION_SUCCEED  | DESCRIBE      | DESCRIBE SCHEMAS DATABASE users                                      |                    |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+--------------------+---------------+----------------------------------------------------------------------+--------------------+
   | 2       | 6/30/2022 10:59 | null             | sqream        | 920ca5ec-c34f-443d-a131-8cd296a73c9c  | 2             |                        |                     | EXECUTION_SUCCEED  | DESCRIBE      | DESCRIBE DATABASES                                                   |                    |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+--------------------+---------------+----------------------------------------------------------------------+--------------------+
   |         | 6/30/2022 10:59 | null             | sqream        | c301c9d8-08f6-481c-8443-1101ad33856b  |               |                        |                     | Active             | SESSION       |                                                                      |                    |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+--------------------+---------------+----------------------------------------------------------------------+--------------------+
   | 1       | 6/30/2022 10:59 | null             | sqream        | c301c9d8-08f6-481c-8443-1101ad33856b  | 1             |                        |                     | EXECUTION_SUCCEED  | DESCRIBE      | DESCRIBE TABLES DATABASE users SCHEMA public INTERNAL                |                    |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+--------------------+---------------+----------------------------------------------------------------------+--------------------+
   |         | sqream          |                  |               |                                       |               |                        |                     |                    |               |                                                                      |                    |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+--------------------+---------------+----------------------------------------------------------------------+--------------------+
   | 1       | 6/30/2022 10:59 | null             | sqream        | 7346a30a-63fe-4760-8b3c-a4019289b548  | 1             |                        |                     | EXECUTION_SUCCEED  | DDL           | CREATE TABLE cool_animals1 (id INT NOT NULL, name TEXT, weight INT)  |                    |
   +---------+-----------------+------------------+---------------+---------------------------------------+---------------+------------------------+---------------------+--------------------+---------------+----------------------------------------------------------------------+--------------------+
   
Permissions
====================
Using the ``AUDIT_LOG`` command requires ``SUPERUSER`` permissions.

For more information, see `Supported Permissions <https://docs.sqream.com/en/2022.3_preview/reference/sql/sql_statements/access_control_commands/alter_default_permissions.html#supported-permissions>`_.