.. _4.6:

*****************
Release Notes 4.6
*****************

The 4.6 release notes were released on February 19, 2024

.. contents:: 
   :local:
   :depth: 1      

Compatibility Matrix
--------------------
 
+-------------------------+------------------------------------------------------------------------+
| System Requirement      | Details                                                                |
+=========================+========================================================================+
| Supported OS            | * CentOS - 7.x                                                         |
|                         | * RHEL - 7.x / 8.x                                                     |
+-------------------------+------------------------------------------------------------------------+
| supported Nvidia driver | CUDA version from 10.1 up to 11.4.3                                    |
+-------------------------+------------------------------------------------------------------------+
| Storage version         |   51                                                                   |
+-------------------------+------------------------------------------------------------------------+
| Driver compatibility    | * JDBC 5.2.0                                                           |
|                         | * ODBC 4.4.4                                                           | 
|                         | * NodeJS                                                               |
|                         | * .NET 3.0.2                                                           |
|                         | * Pysqream 5.0.0                                                       |
|                         | * Spark 5.0.0                                                          |
|                         | * SQLoader 7.12 (compatible with v4.6.1 or later)                      |
+-------------------------+------------------------------------------------------------------------+

New Features and Enhancements
-----------------------------

► SQreamDB operates with utmost efficiency when processing tables containing large data chunks. Introducing a new :ref:`rechunk` utility function, it simplifies the management of tables with small data chunks. This feature enables users to merge small data chunks into larger ones and simultaneously eliminating any deleted records present.

► A new :ref:`ldap` configuration flag allows including LDAP user attributes in your SQreamDB metadata by associating these attributes with SQreamDB roles.  

► The ``clientReconnectionTimeout`` configuration flag has been reclassified as a cluster configuration flag. Unlike session flags, cluster flags apply to the entire cluster and persist across system restarts or shutdowns, retaining the configured value. Learn more about :ref:`SQreamDB configuration flags<current_method_configuration_levels>`

► JDBC enhancements have been implemented to facilitate the retrieval of the record count for the updated number of rows during ``INSERT`` and ``DELETE`` operations when connecting to a third-party platform via JDBC. Use the SQreamDB JDBC connector as usual; the sole distinction is in the ability to now observe the updated number of rows.

► Two new conditional functions that shorten complex query runtime by checking for the existence of tables and views within the specified schema:

* :ref:`is_table_exists`
* :ref:`is_view_exists`

► The ``TOP`` clause can now take a **subtraction** arithmetic operator when used in a :ref:`select` statement. 

► Sing in to SQreamDB Acceleration Studio using your universal :ref:`Single Sign-On (SSO)<sso>` provider authentication. 

► You may now retrieve and manipulate data from different databases within a single SQreamDB cluster through the execution of a single SQL statement using the :ref:`Cross-Database<cross_database_query>` syntax.

► Enhance your :ref:`COPY FROM<copy_from>` operations with the new ``DELETE_SOURCE_ON_SUCCESS`` parameter, which automatically deletes the source file being copied into SQreamDB. This not only saves time and effort in cleaning cloud storage but also helps conserve storage space.

► Safely cast data types with the new :ref:`IsCastable<is_castable>` function. This function allows you to check whether a cast operation is possible or supported for a given column and data type and provides an alternative when an exception occurs when used within a ``CASE`` statement.

► Enable automatic termination of queries that exceed a pre-defined time limit in the queue. The introduction of the :ref:`queueTimeoutMinutes flag<current_method_configuration_levels>` flag empowers you to set time constraints for queries in the queue, ranging from a few minutes to a maximum of 72 hours.

► You may now set your :ref:`Server Picker<server_picker_cli_reference>` more easily using keyword arguments.

► We enhanced our :ref:`Saved Query<saved_queries>` permissions, ensuring that your saved queries are accessible and can be executed and reviewed exclusively by authorized users.

► Our :ref:`Pysqream<sqlalchemy>` connector now support SQLAlchemy version 2.0.27.

Known Issues
------------

* :ref:`Percentile<percentile_disc>` is not supported for :ref:`Window Functions<window_functions>`

Version 4.6 resolved Issues
---------------------------

+--------------------+---------------------------------------------------------------------------------------------------------------------+
| **SQ No.**         | **Description**                                                                                                     |
+====================+=====================================================================================================================+
| SQ-12872           | Fixed unexpected Worker behavior caused by ``DROP TABLE`` statement                                                 |
+--------------------+---------------------------------------------------------------------------------------------------------------------+
| SQ-12873           | Improved the time it takes to delete metadata keys                                                                  |
+--------------------+---------------------------------------------------------------------------------------------------------------------+
| SQ-12965           | Fixed ``ReadParquet`` chunk producer output                                                                         |
+--------------------+---------------------------------------------------------------------------------------------------------------------+
| SQ-13057           | Fixed ``DOUBLE`` casting into ``TEXT`` issue                                                                        |
+--------------------+---------------------------------------------------------------------------------------------------------------------+
| SQ-15691           | Fixed ``TEXT`` casting into ``DOUBLE`` and ``NUMERIC`` issue when using scientific notation                         |
+--------------------+---------------------------------------------------------------------------------------------------------------------+
| SQ-15828           | Fixed slow query runtime due to ``VIEW`` unexpected behavior                                                        |
+--------------------+---------------------------------------------------------------------------------------------------------------------+
| SQ-16397           | Fixed database tree UI rendering issue                                                                              |
+--------------------+---------------------------------------------------------------------------------------------------------------------+
| SQ-16531           | Resolved the error encountered when trying to create a ``VIEW`` using a table that requires a cleanup operation     |
+--------------------+---------------------------------------------------------------------------------------------------------------------+
| SQ-16592           | Fixed a discrepancy issue following ``OR`` condition execution                                                      |
+--------------------+---------------------------------------------------------------------------------------------------------------------+




Deprecations
-------------------

► **CentOS Linux 7.x**

* As of June 2024, CentOS Linux 7.x will reach its End of Life and will not be supported by SQreamDB. This announcement provides a one-year advance notice for our users to plan for this change. We recommend users to explore migration or upgrade options to maintain ongoing support and security beyond this date. 

Upgrading to Version 4.6
-------------------------

1. Generate a back-up of the metadata by running the following command:

   .. code-block:: console

      select backup_metadata('out_path');
	  
   .. tip:: SQreamDB recommends storing the generated back-up locally in case needed.
   
   SQreamDB runs the Garbage Collector and creates a clean backup tarball package.
   
2. Shut down all SQreamDB services.

3. Copy the recently created back-up file.

4. Replace your current metadata with the metadata you stored in the back-up file.

5. Navigate to the new SQreamDB package bin folder.

6. Run the following command:

   .. code-block:: console

      ./upgrade_storage <levelDB path>
	
7. Version 4.4 introduces a service permission feature that enables superusers to grant and revoke role access to services. However, when upgrading from version 4.2 or earlier to version 4.4 or later, this feature initializes access to services, causing existing roles to lose their access to services. 

There are two methods of granting back access to services:

   * Grant access to all services for all roles using the :ref:`grant_usage_on_service_to_all_roles` utility function
   * Selectively grant or revoke access to services by following the :ref:`access permission guide<access_control_permissions>`


  .. note:: Upgrading from a major version to another major version requires you to follow the **Upgrade Storage** step. This is described in Step 7 of the `Upgrading SQreamDB Version <../installation_guides/installing_sqream_with_binary.html#upgrading-sqream-version>`_ procedure.
  
