.. _2021.2:

**************************
What's new in 2021.2
**************************

* 24 bugs fixed.
* Major performance enhancements.

Performance Enhancements
=========================
* Major feature release targeted for all on-premises customers.
* Includes basic Cloud functionality.

New Features
=========================


* Supports ``numeric(p, s)`` numeric data types where ``p`` is the total number of digits, (``38`` maximum), and ``s`` is the total number of decimal digits.
* **Question: I think each bullet below should be set off as its own section to make the document look more organized, because the example breaks the flow.**



Example:
   
   .. code-block:: none
      
      create or replace table t(x numeric(20, 10), y numeric(38, 38));
      insert into t values(1234567890.1234567890, 0.123245678901234567890123456789012345678);
      select x + y from t;

* **Question: Should this bullet be included in Known Issues and Limitations below?**
* Does not support Numeric Literal operations and known issues.

* Supports the following types:

   * All join types
   * All aggregation types
   * Scalar functions **(waiting for the list of limitations)**

* Text data type major bug fixes and functionality enhancements:

   * **Question: Which of the following are bug fixes and which are functionality enhancements?)**
   * Support text columns in queries with multiple distinct aggregates.
   * Text literal support for all functions.
   * Use LoopJoin instead of CrossJoin for join on Text keys.
    

* Supports Partial Sub-Queries.

See `currently supported functionality <https://sqream.atlassian.net/wiki/spaces/RF/pages/1433894919/Sub-Queries+support+and+limitations+in+SQream+DB+v2021.1>`_.
**Question: if this is a new feature, why is there existing documentation? Is this actually an enhancement, or really a new feature?**

* Literal arguments are now supported in all cases where column arguments are supported for a certain function. Literal arguments are only supported if the Literal value is  the same TYPE as the column.

* Supports Simple Scalar SQL UDFs.
See `supported syntax and usage <https://sqream.atlassian.net/wiki/spaces/RF/pages/1433731135/Simple+Scalar+SQL+UDF+s>`_.

* Logging enhancements - the following log information has been added for the following events:

  * Compilation start time.
  * When **(time?)** of the first metadata callback in the compiler (if relevant).
  * When **(time?)** of the last metadata callback in the compiler (if relevant).
  * When it **(the compilation?)** started attempting to get locks **(note: to be reviewed how statements get locks)**.
  * When **(time?)** a statement entered the queue.
  * When **(time?)** a statement exited the queue.
  * When **(time?)** a client has connected to this **(which?)** sqreamd (if it reconnects).
  * When **(time?)** it **(the compilation?)** started executing.


* Optimized foreign data wrapper export:

  * WriteToFile chuck producer code paralleled to enhance performance. Transferring **(is "transferring" the right word here? Consider using "formatting.")** WriteToFile as a threaded chunk producer results in multi-thread export for orc, parquet, and csv, with better performance.
  
  We paralleled the WriteToFile chunk producer code to gain better performance.

Transferring WriteToFile to be a threaded chunk producer results in multi-thread export for orc, parquet, and csv and presents better performance.

Usage:

Two runTimeGlobal flags control the feature:

copyToMaxMBPerFile (default: 0)

WriteToFileThreads (default: 16)

If copyToMaxMBPerFile=0 - no parallelism, the feature is off

If copyToMaxMBPerFile = N - multi-thread is ON and N is the maximum file size in MB

We witnessed the best results for 10/20 MB files and 16 writing threads, i.e.

copyToMaxMBPerFile = from 10 to 20 and WriteToFileThreads =16

Usage example:

The following ``runTimeGlobal`` flags control exporting foreign data wrappers:

``copyToMaxMBPerFile`` (default: 0)

``WriteToFileThreads`` (default: 16)

If ``copyToMaxMBPerFile = 0`` - no parallelism. The feature is disabled. **Comment: added space before and after the 0. Compare to below.**

If ``copyToMaxMBPerFile = N`` - multi-thread is enabled, withN as the maximum file size (MB).

For best results, set ``copyToMaxMBPerFile to 10/20 MB files, and set ``WriteToFileThreads`` to 16.



Known Issues and Limitations
================================
* Production core dump from stability test
* Performance degradation - joins - outer_join1.sql
* Performance degradation - south_africa-sa4.sql
* Performance degradation - groupby - groupby_int_func_nvarchar40.sql

Upgrading to v2021.2
========================

Versions are available for IBM POWER9, RedHat (CentOS) 7, Ubuntu 18.04, and other OSs via Docker.

Contact your account manager to get the latest release of SQream DB.
