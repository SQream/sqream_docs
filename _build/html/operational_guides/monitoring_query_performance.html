<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Monitoring Query Performance &mdash; SQream DB 4.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Security" href="security.html" />
    <link rel="prev" title="Logging" href="logging.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #133148" >
            <a href="../index.html">
            <img src="../_static/SQream_logo_without background-15.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/preparing_your_machine_to_install_sqream.html">Preparing Your Machine to Install SQream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/installing_sqream.html">Installing SQream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/executing_statements_in_sqream.html">Executing Statements in SQream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/performing_basic_sqream_operations.html">Performing Basic SQream Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/running_the_sqream_sql_client.html">Running the SQream SQL Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/creating_your_first_table.html">Creating Your First Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/listing_tables.html">Listing Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/inserting_rows.html">Inserting Rows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/running_queries.html">Running Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/deleting_rows.html">Deleting Rows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/saving_query_results_to_a_csv_or_psv_file.html">Saving Query Results to a CSV or PSV File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/hardware_guide.html">Hardware Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation_guides/index.html">Installation Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation_guides/installing_and_launching_sqream.html">Installing and Launching SQream</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/recommended_pre-installation_configurations.html">Recommended Pre-Installation Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/installing_sqream_with_binary.html">Installing SQream Using Binary Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/running_sqream_in_a_docker_container.html">Installing and Running SQream in a Docker Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/installing_sqream_with_kubernetes.html">Installing SQream with Kubernetes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/installing_monit.html">Installing Monit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/launching_sqream_with_monit.html">Launching SQream with Monit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation_guides/sqream_studio_installation.html">Installing SQream Studio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/installing_prometheus_exporters.html">Installing Prometheus Exporter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/installing_prometheus_using_binary_packages.html">Installing Prometheus Using Binary Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/installing_dashboard_data_collector.html">Installing the Dashboard Data Collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/installing_studio_on_stand_alone_server.html">Installing Studio on a Stand-Alone Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation_guides/installing_nginx_proxy_over_secure_connection.html">Installing an NGINX Proxy Over a Secure Connection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/index.html">Data Ingestion Sources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../data_ingestion/ingesting_data.html">Ingesting Data Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_ingestion/avro.html">Ingesting Data from Avro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_ingestion/csv.html">Ingesting Data from a CSV File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_ingestion/parquet.html">Ingesting Data from a Parquet File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_ingestion/orc.html">Ingesting Data from an ORC File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_ingestion/json.html">Ingesting Data from JSON</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../connecting_to_sqream/index.html">Connecting to SQream</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../connecting_to_sqream/client_platforms/index.html">Client Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/informatica.html">Connect to SQream Using Informatica Cloud Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/microstrategy.html">Connect to SQream Using MicroStrategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/pentaho.html">Connecting to SQream Using Pentaho Data Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/php.html">Connect to SQream Using PHP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/power_bi.html">Connecting to SQream Using Power BI Desktop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/r.html">Connect to SQream Using R</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/sap_businessobjects.html">Connecting to SQream Using SAP BusinessObjects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/sas_viya.html">Connect to SQream Using SAS Viya</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/sql_workbench.html">Connect to SQream Using SQL Workbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/tableau.html">Connecting to SQream Using Tableau</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/talend.html">Connecting to SQream Using Talend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_platforms/tibco_spotfire.html">Connecting to SQream Using TIBCO Spotfire</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../connecting_to_sqream/client_drivers/index.html">Client Drivers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_drivers/trino/index.html">Connecting to SQream Using Trino</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_drivers/jdbc/index.html">JDBC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_drivers/python/index.html">Connecting to SQream Using Python (pysqream)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_drivers/nodejs/index.html">Connecting to SQream Using Node.JS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_drivers/odbc/index.html">ODBC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../connecting_to_sqream/client_drivers/odbc/install_configure_odbc_windows.html">Install and Configure ODBC on Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../connecting_to_sqream/client_drivers/odbc/install_configure_odbc_linux.html">Install and configure ODBC on Linux</a><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_drivers/dotnet/index.html">Connecting to SQream Using .NET</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connecting_to_sqream/client_drivers/Spark/index.html">Using Spark With SQream</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../external_storage_platforms/index.html">External Storage Platforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../external_storage_platforms/s3.html">Inserting Data Using Amazon S3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../external_storage_platforms/hdfs.html">Using SQream in an HDFS Environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../loading_and_unloading_data/index.html">Loading and Unloading Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature_guides/index.html">Feature Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/automatic_foreign_table_ddl_resolution.html">Automatic Foreign Table DDL Resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/query_healer.html">Query Healer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/data_encryption.html">Data Encryption</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../feature_guides/data_encryption_overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../feature_guides/data_encryption_methods.html">Encryption Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../feature_guides/data_encryption_types.html">Data Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../feature_guides/data_encryption_syntax.html">Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../feature_guides/data_encryption_permissions.html">Permissions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/compression.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/python_functions.html">Python UDF (User-Defined Functions)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/workload_manager.html">Workload Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/concurrency_and_locks.html">Concurrency and Locks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/concurrency_and_scaling_in_sqream.html">Concurrency and Scaling in SQream DB</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Operational Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="access_control.html">Access Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="access_control_overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_control_password_policy.html">Password Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_control_managing_roles.html">Managing Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_control_permissions.html">Permissions</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_control_departmental_example.html">Departmental Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="creating_or_cloning_a_storage_cluster.html">Creating or Cloning Storage Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_data.html">Working with External Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="s3.html">Inserting Data Using Amazon S3</a></li>
<li class="toctree-l3"><a class="reference internal" href="hdfs.html">Using SQream in an HDFS Environment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="foreign_tables.html">Foreign Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="delete_guide.html">Deleting Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="exporting_data.html">Exporting Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Monitoring Query Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="saved_queries.html">Saved Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="seeing_system_objects_as_ddl.html">Seeing System Objects as DDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization_best_practices.html">Optimization and Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sqream_studio_5.4.7/index.html">SQream Acceleration Studio 5.4.7</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sqream_studio_5.4.7/getting_started.html">Getting Started with SQream Acceleration Studio 5.4.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sqream_studio_5.4.7/monitoring_workers_and_services_from_the_dashboard.html">Monitoring Workers and Services from the Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sqream_studio_5.4.7/executing_statements_and_running_queries_from_the_editor.html">Executing Statements and Running Queries from the Editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sqream_studio_5.4.7/viewing_logs.html">Viewing Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sqream_studio_5.4.7/creating_assigning_and_managing_roles_and_permissions.html">Creating, Assigning, and Managing Roles and Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sqream_studio_5.4.7/configuring_your_instance_of_sqream.html">Configuring Your Instance of SQreams</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">System Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../architecture/internals_architecture.html">Internals and architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture/filesystem_and_filesystem_usage.html">Filesystem and usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_guides/index.html">Configuration Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration_guides/spooling.html">Configuring the Spooling Feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration_guides/configuring_sqream.html">Configuring SQream</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/current_method_configuration_levels.html">Configuration Levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/current_method_flag_types.html">Flag Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/current_method_configuration_roles.html">Configuration Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/current_method_modification_methods.html">Modification Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/current_method_configuring_your_parameter_values.html">Configuring Your Parameter Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/current_method_command_examples.html">Command Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/current_method_showing_all_flags_in_the_catalog_table.html">Showing All Flags in the Catalog Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/current_method_all_configurations.html">All Configurations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../configuration_guides/ldap.html">Configuring LDAP authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration_guides/configuration_flags.html">Configuration Flags</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/admin_flags.html">Administration Flags</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../configuration_guides/admin_regular_flags.html">Regular Administration Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration_guides/admin_cluster_flags.html">Cluster Administration Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration_guides/admin_worker_flags.html">Worker Administration Flags</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/generic_flags.html">Generic Flags</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../configuration_guides/generic_regular_flags.html">Regular Generic Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration_guides/generic_worker_flags.html">Worker Generic Flags</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../configuration_guides/previous_configuration_method.html">Configuring SQream Using the Previous Configuration Method</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/sql/index.html">SQL Statements and Syntax</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/sql/sql_syntax/index.html">SQL Syntax Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/sql/sql_statements/index.html">SQL Statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/sql/sql_functions/index.html">SQL Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/sql/sql_functions/scalar_functions/index.html">Built-In Scalar Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sql/sql_functions/user_defined_functions/index.html">User-Defined Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sql/sql_functions/aggregate_functions/index.html">Aggregate Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sql/sql_functions/window_functions/index.html">Window Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/catalog_reference.html">Catalog Reference Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/catalog_reference_overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/catalog_reference_schema_information.html">What Information Does the Schema Contain?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/catalog_reference_catalog_tables.html">Catalog Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/catalog_reference_additonal_tables.html">Additional Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/catalog_reference_examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/cli/index.html">Command line programs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/cli/metadata_server.html">metadata_server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cli/sqreamd.html">sqreamd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cli/sqream_console.html">sqream-console</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cli/sqream_installer.html">sqream-installer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cli/server_picker.html">Server Picker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cli/sqream_storage.html">SqreamStorage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cli/sqream_sql.html">sqream sql</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cli/upgrade_storage.html">upgrade_storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sql_feature_support.html">SQL Feature Checklist</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data_type_guides/index.html">Data Type Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../data_type_guides/converting_and_casting_types.html">Converting and Casting Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_type_guides/supported_data_types.html">Supported Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_type_guides/supported_casts.html">Supported Casts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_numeric.html">Numeric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_boolean.html">Boolean</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_integer.html">Integer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_floating_point.html">Floating Point</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_string.html">String</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_date.html">Date</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../releases/4.0_index.html">Release Notes 4.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../releases/4.0.html">Release Notes 4.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/4.1.html">Release Notes 4.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/4.2.html">Release Notes 4.2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../releases/2022.1_index.html">Release Notes 2022.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../releases/2022.1.7.html">Release Notes 2022.1.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2022.1.6.html">Release Notes 2022.1.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2022.1.5.html">Release Notes 2022.1.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2022.1.4.html">Release Notes 2022.1.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2022.1.3.html">Release Notes 2022.1.3</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2022.1.2.html">Release Notes 2022.1.2</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2022.1.1.html">Release Notes 2022.1.1</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2022.1.html">Release Notes 2022.1</a><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../releases/2021.2_index.html">Release Notes 2021.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../releases/2021.2.1.24.html">Release Notes 2021.2.1.24</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2021.2.1.html">Release Notes 2021.2.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2021.2.html">Release Notes 2021.2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../releases/2021.1_index.html">Release Notes 2021.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../releases/2021.1.2.html">Release Notes 2021.1.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2021.1.html">Release Notes 2021.1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../releases/2020.3_index.html">Release Notes 2020.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../releases/2020.3.2.1.html">Release Notes 2020.3.2.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2020.3.2.html">What’s new in 2020.3.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2020.3.1.html">Release Notes 2020.3.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../releases/2020.3.html">Release Notes 2020.3</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../releases/2020.2.html">Release Notes 2020.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/2020.1.html">Release Notes 2020.1</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/remedying_slow_queries.html">Remedying Slow Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/resolving_common_issues.html">Resolving Common Issues</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/examining_logs.html">Examining Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/identifying_configuration_issues.html">Identifying Configuration Issues</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/lock_related_issues.html">Lock Related Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/log_related_issues.html">Log Related Issues</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/core_dumping_related_issues.html">Core Dumping Related Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/information_for_support.html">Gathering Information for SQream Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #133148" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SQream DB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Operational Guides</a> &raquo;</li>
      <li>Monitoring Query Performance</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="monitoring-query-performance">
<span id="id1"></span><h1>Monitoring Query Performance<a class="headerlink" href="#monitoring-query-performance" title="Permalink to this heading"></a></h1>
<p>When analyzing options for query tuning, the first step is to analyze the query plan and execution.
The query plan and execution details explains how SQream DB processes a query and where time is spent.
This document details how to analyze query performance with execution plans.
This guide focuses specifically on identifying bottlenecks and possible optimization techniques to improve query performance.
Performance tuning options for each query are different. You should adapt the recommendations and tips for your own workloads.
See also our <a class="reference internal" href="optimization_best_practices.html#sql-best-practices"><span class="std std-ref">Optimization and Best Practices</span></a> guide for more information about data loading considerations and other best practices.</p>
<div class="contents local topic" id="in-this-section">
<p class="topic-title">In this section:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#setting-up-the-system-for-monitoring" id="id12">Setting Up the System for Monitoring</a></p>
<ul>
<li><p><a class="reference internal" href="#adjusting-the-logging-frequency" id="id13">Adjusting the Logging Frequency</a></p></li>
<li><p><a class="reference internal" href="#reading-execution-plans-with-a-foreign-table" id="id14">Reading Execution Plans with a Foreign Table</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-the-show-node-info-command" id="id15">Using the <code class="docutils literal notranslate"><span class="pre">SHOW_NODE_INFO</span></code> Command</a></p></li>
<li><p><a class="reference internal" href="#understanding-the-query-execution-plan-output" id="id16">Understanding the Query Execution Plan Output</a></p>
<ul>
<li><p><a class="reference internal" href="#information-presented-in-the-execution-plan" id="id17">Information Presented in the Execution Plan</a></p></li>
<li><p><a class="reference internal" href="#commonly-seen-nodes" id="id18">Commonly Seen Nodes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#examples" id="id19">Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#spooling-to-disk" id="id20">1. Spooling to Disk</a></p>
<ul>
<li><p><a class="reference internal" href="#identifying-the-offending-nodes" id="id21">Identifying the Offending Nodes</a></p></li>
<li><p><a class="reference internal" href="#common-solutions-for-reducing-spool" id="id22">Common Solutions for Reducing Spool</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#queries-with-large-result-sets" id="id23">2. Queries with Large Result Sets</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id24">Identifying the Offending Nodes</a></p></li>
<li><p><a class="reference internal" href="#common-solutions-for-reducing-gather-time" id="id25">Common Solutions for Reducing Gather Time</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#inefficient-filtering" id="id26">3. Inefficient Filtering</a></p>
<ul>
<li><p><a class="reference internal" href="#identifying-the-situation" id="id27">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#common-solutions-for-improving-filtering" id="id28">Common Solutions for Improving Filtering</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#joins-with-text-keys" id="id29">4. Joins with <code class="docutils literal notranslate"><span class="pre">text</span></code> Keys</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id30">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#improving-query-performance" id="id31">Improving Query Performance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#sorting-on-big-text-fields" id="id32">5. Sorting on big <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> fields</a></p>
<ul>
<li><p><a class="reference internal" href="#id5" id="id33">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#improving-sort-performance-on-text-keys" id="id34">Improving Sort Performance on Text Keys</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#high-selectivity-data" id="id35">6. High Selectivity Data</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id36">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#improving-performance-with-high-selectivity-hints" id="id37">Improving Performance with High Selectivity Hints</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-of-unsorted-data-in-joins" id="id38">7. Performance of unsorted data in joins</a></p>
<ul>
<li><p><a class="reference internal" href="#id7" id="id39">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#improving-join-performance-when-data-is-sparse" id="id40">Improving Join Performance when Data is Sparse</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#manual-join-reordering" id="id41">8. Manual Join Reordering</a></p>
<ul>
<li><p><a class="reference internal" href="#id8" id="id42">Identifying the situation</a></p></li>
<li><p><a class="reference internal" href="#changing-the-join-order" id="id43">Changing the Join Order</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#further-reading" id="id44">Further Reading</a></p></li>
</ul>
</div>
<section id="setting-up-the-system-for-monitoring">
<h2><a class="toc-backref" href="#id12">Setting Up the System for Monitoring</a><a class="headerlink" href="#setting-up-the-system-for-monitoring" title="Permalink to this heading"></a></h2>
<p>By default, SQream DB logs execution details for every statement that runs for more than 60 seconds.
If you want to see the execution details for a currently running statement, see <a class="reference internal" href="#using-show-node-info"><span class="std std-ref">Using the SHOW_NODE_INFO Command</span></a> below.</p>
<section id="adjusting-the-logging-frequency">
<h3><a class="toc-backref" href="#id13">Adjusting the Logging Frequency</a><a class="headerlink" href="#adjusting-the-logging-frequency" title="Permalink to this heading"></a></h3>
<p>To adjust the frequency of logging for statements, you may want to reduce the interval from 60 seconds down to,
say, 5 or 10 seconds. Modify the configuration files and set the <code class="docutils literal notranslate"><span class="pre">nodeInfoLoggingSec</span></code> parameter as you see fit:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;compileFlags&quot;</span><span class="p">:{</span><span class="w"></span>
<span class="w">   </span><span class="p">},</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;runtimeFlags&quot;</span><span class="p">:{</span><span class="w"></span>
<span class="w">   </span><span class="p">},</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;runtimeGlobalFlags&quot;</span><span class="p">:{</span><span class="w"></span>
<span class="hll"><span class="w">      </span><span class="nt">&quot;nodeInfoLoggingSec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"></span>
</span><span class="w">   </span><span class="p">},</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;server&quot;</span><span class="p">:{</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>After restarting the SQream DB cluster, the execution plan details will be logged to the <a class="reference internal" href="logging.html#logging"><span class="std std-ref">standard SQream DB logs directory</span></a>, as a message of type <code class="docutils literal notranslate"><span class="pre">200</span></code>.
You can see these messages with a text viewer or with queries on the log <span class="xref std std-ref">external_tables</span>.</p>
</section>
<section id="reading-execution-plans-with-a-foreign-table">
<h3><a class="toc-backref" href="#id14">Reading Execution Plans with a Foreign Table</a><a class="headerlink" href="#reading-execution-plans-with-a-foreign-table" title="Permalink to this heading"></a></h3>
<p>First, create a foreign table for the logs</p>
<p>Once you’ve defined the foreign table, you can run queries to observe the previously logged execution plans.
This is recommended over looking at the raw logs.</p>
</section>
</section>
<section id="using-the-show-node-info-command">
<span id="using-show-node-info"></span><h2><a class="toc-backref" href="#id15">Using the <code class="docutils literal notranslate"><span class="pre">SHOW_NODE_INFO</span></code> Command</a><a class="headerlink" href="#using-the-show-node-info-command" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="../reference/sql/sql_statements/utility_commands/show_node_info.html#show-node-info"><span class="std std-ref">SHOW_NODE_INFO</span></a> command returns a snapshot of the current query plan, similar to <code class="docutils literal notranslate"><span class="pre">EXPLAIN</span> <span class="pre">ANALYZE</span></code> from other databases.
The <a class="reference internal" href="../reference/sql/sql_statements/utility_commands/show_node_info.html#show-node-info"><span class="std std-ref">SHOW_NODE_INFO</span></a> result, just like the periodically-logged execution plans described above, are an at-the-moment
view of the compiler’s execution plan and runtime statistics for the specified statement.
To inspect a currently running statement, execute the <code class="docutils literal notranslate"><span class="pre">show_node_info</span></code> utility function in a SQL client like</p>
<blockquote>
<div><p><a class="reference internal" href="../reference/cli/sqream_sql.html#sqream-sql-cli-reference"><span class="std std-ref">sqream sql</span></a>, the <span class="xref std std-ref">SQream Studio Editor</span>, or any other <span class="xref std std-ref">third party SQL terminal</span>.</p>
</div></blockquote>
<p>In this example, we inspect a statement with statement ID of 176. The command looks like this:</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">SHOW_NODE_INFO</span><span class="p">(</span><span class="mf">176</span><span class="p">);</span><span class="w"></span>
<span class="go">stmt_id | node_id | node_type          | rows | chunks | avg_rows_in_chunk | time                | parent_node_id | read | write | comment    | timeSum</span>
<span class="go">--------+---------+--------------------+------+--------+-------------------+---------------------+----------------+------+-------+------------+--------</span>
<span class="go">    176 |       1 | PushToNetworkQueue |    1 |      1 |                 1 | 2019-12-25 23:53:13 |             -1 |      |       |            |  0.0025</span>
<span class="go">    176 |       2 | Rechunk            |    1 |      1 |                 1 | 2019-12-25 23:53:13 |              1 |      |       |            |       0</span>
<span class="go">    176 |       3 | GpuToCpu           |    1 |      1 |                 1 | 2019-12-25 23:53:13 |              2 |      |       |            |       0</span>
<span class="go">    176 |       4 | ReorderInput       |    1 |      1 |                 1 | 2019-12-25 23:53:13 |              3 |      |       |            |       0</span>
<span class="go">    176 |       5 | Filter             |    1 |      1 |                 1 | 2019-12-25 23:53:13 |              4 |      |       |            |  0.0002</span>
<span class="go">    176 |       6 | GpuTransform       |  457 |      1 |               457 | 2019-12-25 23:53:13 |              5 |      |       |            |  0.0002</span>
<span class="go">    176 |       7 | GpuDecompress      |  457 |      1 |               457 | 2019-12-25 23:53:13 |              6 |      |       |            |       0</span>
<span class="go">    176 |       8 | CpuToGpu           |  457 |      1 |               457 | 2019-12-25 23:53:13 |              7 |      |       |            |  0.0003</span>
<span class="go">    176 |       9 | Rechunk            |  457 |      1 |               457 | 2019-12-25 23:53:13 |              8 |      |       |            |       0</span>
<span class="go">    176 |      10 | CpuDecompress      |  457 |      1 |               457 | 2019-12-25 23:53:13 |              9 |      |       |            |       0</span>
<span class="go">    176 |      11 | ReadTable          |  457 |      1 |               457 | 2019-12-25 23:53:13 |             10 | 4MB  |       | public.nba |  0.0004</span>
</pre></div>
</div>
</section>
<section id="understanding-the-query-execution-plan-output">
<h2><a class="toc-backref" href="#id16">Understanding the Query Execution Plan Output</a><a class="headerlink" href="#understanding-the-query-execution-plan-output" title="Permalink to this heading"></a></h2>
<p>Both <a class="reference internal" href="../reference/sql/sql_statements/utility_commands/show_node_info.html#show-node-info"><span class="std std-ref">SHOW_NODE_INFO</span></a>  and the logged execution plans represents the query plan as a graph hierarchy, with data separated into different columns.
Each row represents a single logical database operation, which is also called a <strong>node</strong> or <strong>chunk producer</strong>. A node reports
several metrics during query execution, such as how much data it has read and written, how many chunks and rows, and how much time has elapsed.
Consider the example show_node_info presented above. The source node with ID #11 (<code class="docutils literal notranslate"><span class="pre">ReadTable</span></code>), has a parent node ID #10
(<code class="docutils literal notranslate"><span class="pre">CpuDecompress</span></code>). If we were to draw this out in a graph, it’d look like this:
.. figure:: /_static/images/show_node_info_graph.png</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">height</dt>
<dd class="field-odd"><p>70em</p>
</dd>
<dt class="field-even">align</dt>
<dd class="field-even"><p>center</p>
</dd>
</dl>
<p>This graph explains how the query execution details are arranged in a logical order, from the bottom up.</p>
</div></blockquote>
<p>The last node, also called the sink, has a parent node ID of -1, meaning it has no parent. This is typically a node that sends data over the network or into a table.</p>
<p>When using <a class="reference internal" href="../reference/sql/sql_statements/utility_commands/show_node_info.html#show-node-info"><span class="std std-ref">SHOW_NODE_INFO</span></a>, a tabular representation of the currently running statement execution is presented.
See the examples below to understand how the query execution plan is instrumental in identifying bottlenecks and optimizing long-running statements.</p>
<section id="information-presented-in-the-execution-plan">
<h3><a class="toc-backref" href="#id17">Information Presented in the Execution Plan</a><a class="headerlink" href="#information-presented-in-the-execution-plan" title="Permalink to this heading"></a></h3>
</section>
<section id="commonly-seen-nodes">
<h3><a class="toc-backref" href="#id18">Commonly Seen Nodes</a><a class="headerlink" href="#commonly-seen-nodes" title="Permalink to this heading"></a></h3>
<table class="colwidths-auto docutils align-default" id="id9">
<caption><span class="caption-text">Node types</span><a class="headerlink" href="#id9" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Column name</p></th>
<th class="head"><p>Execution location</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CpuDecompress</span></code></p></td>
<td><p>CPU</p></td>
<td><p>Decompression operation, common for longer <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> types</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CpuLoopJoin</span></code></p></td>
<td><p>CPU</p></td>
<td><p>A non-indexed nested loop join, performed on the CPU</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CpuReduce</span></code></p></td>
<td><p>CPU</p></td>
<td><p>A reduce process performed on the CPU, primarily with <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> aggregates (e.g. <code class="docutils literal notranslate"><span class="pre">COUNT(DISTINCT</span> <span class="pre">...)</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CpuToGpu</span></code>, <code class="docutils literal notranslate"><span class="pre">GpuToCpu</span></code></p></td>
<td></td>
<td><p>An operation that moves data to or from the GPU for processing</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CpuTransform</span></code></p></td>
<td><p>CPU</p></td>
<td><p>A transform operation performed on the CPU, usually a <a class="reference internal" href="../reference/sql/sql_functions/scalar_functions/index.html#scalar-functions"><span class="std std-ref">scalar function</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DeferredGather</span></code></p></td>
<td><p>CPU</p></td>
<td><p>Merges the results of GPU operations with a result set</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Distinct</span></code></p></td>
<td><p>GPU</p></td>
<td><p>Removes duplicate rows (usually as part of the <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> operation)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Distinct_Merge</span></code></p></td>
<td><p>CPU</p></td>
<td><p>The merge operation of the <code class="docutils literal notranslate"><span class="pre">Distinct</span></code> operation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Filter</span></code></p></td>
<td><p>GPU</p></td>
<td><p>A filtering operation, such as a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> or <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> clause</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GpuDecompress</span></code></p></td>
<td><p>GPU</p></td>
<td><p>Decompression operation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GpuReduceMerge</span></code></p></td>
<td><p>GPU</p></td>
<td><p>An operation to optimize part of the merger phases in the GPU</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GpuTransform</span></code></p></td>
<td><p>GPU</p></td>
<td><p>A transformation operation such as a type cast or <a class="reference internal" href="../reference/sql/sql_functions/scalar_functions/index.html#scalar-functions"><span class="std std-ref">scalar function</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LocateFiles</span></code></p></td>
<td><p>CPU</p></td>
<td><p>Validates external file paths for foreign data wrappers, expanding directories and GLOB patterns</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LoopJoin</span></code></p></td>
<td><p>GPU</p></td>
<td><p>A non-indexed nested loop join, performed on the GPU</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ParseCsv</span></code></p></td>
<td><p>CPU</p></td>
<td><p>A CSV parser, used after <code class="docutils literal notranslate"><span class="pre">ReadFiles</span></code> to convert the CSV into columnar data</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PushToNetworkQueue</span></code></p></td>
<td><p>CPU</p></td>
<td><p>Sends result sets to a client connected over the network</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ReadFiles</span></code></p></td>
<td><p>CPU</p></td>
<td><p>Reads external flat-files</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ReadTable</span></code></p></td>
<td><p>CPU</p></td>
<td><p>Reads data from a standard table stored on disk</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Rechunk</span></code></p></td>
<td></td>
<td><p>Reorganize multiple small <span class="xref std std-ref">chunks</span> into a full chunk. Commonly found after joins and when <a class="reference internal" href="optimization_best_practices.html#high-selectivity"><span class="std std-ref">HIGH_SELECTIVITY</span></a> is used</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Reduce</span></code></p></td>
<td><p>GPU</p></td>
<td><p>A reduction operation, such as a <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ReduceMerge</span></code></p></td>
<td><p>GPU</p></td>
<td><p>A merge operation of a reduction operation, helps operate on larger-than-RAM data</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ReorderInput</span></code></p></td>
<td></td>
<td><p>Change the order of arguments in preparation for the next operation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SeparatedGather</span></code></p></td>
<td><p>GPU</p></td>
<td><p>Gathers additional columns for the result</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Sort</span></code></p></td>
<td><p>GPU</p></td>
<td><p>Sort operation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TakeRowsFromChunk</span></code></p></td>
<td></td>
<td><p>Take the first N rows from each chunk, to optimize <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> when used alongside <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Top</span></code></p></td>
<td></td>
<td><p>Limits the input size, when used with <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> (or its alias <code class="docutils literal notranslate"><span class="pre">TOP</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">UdfTransform</span></code></p></td>
<td><p>CPU</p></td>
<td><p>Executes a <a class="reference internal" href="../feature_guides/python_functions.html#python-functions"><span class="std std-ref">user defined function</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">UnionAll</span></code></p></td>
<td></td>
<td><p>Combines two sources of data when <code class="docutils literal notranslate"><span class="pre">UNION</span> <span class="pre">ALL</span></code> is used</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Window</span></code></p></td>
<td><p>GPU</p></td>
<td><p>Executes a non-ranking <a class="reference internal" href="../reference/sql/sql_syntax/window_functions.html#window-functions"><span class="std std-ref">window function</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">WindowRanking</span></code></p></td>
<td><p>GPU</p></td>
<td><p>Executes a ranking <a class="reference internal" href="../reference/sql/sql_syntax/window_functions.html#window-functions"><span class="std std-ref">window function</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">WriteTable</span></code></p></td>
<td><p>CPU</p></td>
<td><p>Writes the result set to a standard table stored on disk</p></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The full list of nodes appears in the <a class="reference internal" href="../reference/sql/sql_statements/utility_commands/show_node_info.html#node-types"><span class="std std-ref">Node types table</span></a>, as part of the <a class="reference internal" href="../reference/sql/sql_statements/utility_commands/show_node_info.html#show-node-info"><span class="std std-ref">SHOW_NODE_INFO</span></a> reference.</p>
</div>
</section>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#id19">Examples</a><a class="headerlink" href="#examples" title="Permalink to this heading"></a></h2>
<p>In general, looking at the top three longest running nodes (as is detailed in the <code class="docutils literal notranslate"><span class="pre">timeSum</span></code> column) can indicate the biggest bottlenecks.
In the following examples you will learn how to identify and solve some common issues.</p>
<div class="contents local topic" id="id2">
<p class="topic-title">In this section:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#spooling-to-disk" id="id45">1. Spooling to Disk</a></p>
<ul>
<li><p><a class="reference internal" href="#identifying-the-offending-nodes" id="id46">Identifying the Offending Nodes</a></p></li>
<li><p><a class="reference internal" href="#common-solutions-for-reducing-spool" id="id47">Common Solutions for Reducing Spool</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#queries-with-large-result-sets" id="id48">2. Queries with Large Result Sets</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id49">Identifying the Offending Nodes</a></p></li>
<li><p><a class="reference internal" href="#common-solutions-for-reducing-gather-time" id="id50">Common Solutions for Reducing Gather Time</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#inefficient-filtering" id="id51">3. Inefficient Filtering</a></p>
<ul>
<li><p><a class="reference internal" href="#identifying-the-situation" id="id52">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#common-solutions-for-improving-filtering" id="id53">Common Solutions for Improving Filtering</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#joins-with-text-keys" id="id54">4. Joins with <code class="docutils literal notranslate"><span class="pre">text</span></code> Keys</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id55">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#improving-query-performance" id="id56">Improving Query Performance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#sorting-on-big-text-fields" id="id57">5. Sorting on big <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> fields</a></p>
<ul>
<li><p><a class="reference internal" href="#id5" id="id58">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#improving-sort-performance-on-text-keys" id="id59">Improving Sort Performance on Text Keys</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#high-selectivity-data" id="id60">6. High Selectivity Data</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id61">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#improving-performance-with-high-selectivity-hints" id="id62">Improving Performance with High Selectivity Hints</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-of-unsorted-data-in-joins" id="id63">7. Performance of unsorted data in joins</a></p>
<ul>
<li><p><a class="reference internal" href="#id7" id="id64">Identifying the Situation</a></p></li>
<li><p><a class="reference internal" href="#improving-join-performance-when-data-is-sparse" id="id65">Improving Join Performance when Data is Sparse</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#manual-join-reordering" id="id66">8. Manual Join Reordering</a></p>
<ul>
<li><p><a class="reference internal" href="#id8" id="id67">Identifying the situation</a></p></li>
<li><p><a class="reference internal" href="#changing-the-join-order" id="id68">Changing the Join Order</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="spooling-to-disk">
<h3><a class="toc-backref" href="#id45">1. Spooling to Disk</a><a class="headerlink" href="#spooling-to-disk" title="Permalink to this heading"></a></h3>
<p>When there is not enough RAM to process a statement, SQream DB will spill over data to the <code class="docutils literal notranslate"><span class="pre">temp</span></code> folder in the storage disk.
While this ensures that a statement can always finish processing, it can slow down the processing significantly.
It’s worth identifying these statements, to figure out if the cluster is configured correctly, as well as potentially reduce
the statement size.
You can identify a statement that spools to disk by looking at the <code class="docutils literal notranslate"><span class="pre">write</span></code> column in the execution details.
A node that spools will have a value, shown in megabytes in the <code class="docutils literal notranslate"><span class="pre">write</span></code> column.
Common nodes that write spools include <code class="docutils literal notranslate"><span class="pre">Join</span></code> or <code class="docutils literal notranslate"><span class="pre">LoopJoin</span></code>.</p>
<section id="identifying-the-offending-nodes">
<h4><a class="toc-backref" href="#id46">Identifying the Offending Nodes</a><a class="headerlink" href="#identifying-the-offending-nodes" title="Permalink to this heading"></a></h4>
<ol class="arabic">
<li><p>Run a query.</p>
<p>For example, a query from the TPC-H benchmark:</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o_year</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;BRAZIL&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mkt_share</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">datepart</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="n">o_orderdate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o_year</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="n">l_extendedprice</span><span class="o">*</span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l_discount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">volume</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="n">n2</span><span class="mf">.</span><span class="n">n_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nation</span><span class="w"></span>
<span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="n">lineitem</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p_partkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="w"> </span><span class="p">(</span><span class="n">l_partkey</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">l_orderkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o_orderkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o_custkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c_custkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n1</span><span class="mf">.</span><span class="n">n_nationkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">n1</span><span class="mf">.</span><span class="n">n_regionkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_regionkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">supplier</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s_suppkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l_suppkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n2</span><span class="mf">.</span><span class="n">n_nationkey</span><span class="w"></span>
<span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">o_orderdate</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;1995-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;1996-12-31&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">all_nations</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o_year</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o_year</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Observe the execution information by using the foreign table, or use <code class="docutils literal notranslate"><span class="pre">show_node_info</span></code></p>
<p>This statement is made up of 199 nodes, starting from a <code class="docutils literal notranslate"><span class="pre">ReadTable</span></code>, and finishes by returning only 2 results to the client.</p>
<p>The execution below has been shortened, but note the highlighted rows for <code class="docutils literal notranslate"><span class="pre">LoopJoin</span></code>:</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">message_type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"></span>
<span class="go">message</span>
<span class="go">-----------------------------------------------------------------------------------------</span>
<span class="go">SELECT o_year,</span>
<span class="go">       SUM(CASE WHEN nation = &#39;BRAZIL&#39; THEN volume ELSE 0 END) / SUM(volume) AS mkt_share</span>
<span class="go"> : FROM (SELECT datepart(YEAR,o_orderdate) AS o_year,</span>
<span class="go"> :              l_extendedprice*(1 - l_discount / 100.0) AS volume,</span>
<span class="go"> :              n2.n_name AS nation</span>
<span class="go"> :       FROM lineitem</span>
<span class="go"> :         JOIN part ON p_partkey = CAST (l_partkey AS INT)</span>
<span class="go"> :         JOIN orders ON l_orderkey = o_orderkey</span>
<span class="go"> :         JOIN customer ON o_custkey = c_custkey</span>
<span class="go"> :         JOIN nation n1 ON c_nationkey = n1.n_nationkey</span>
<span class="go"> :         JOIN region ON n1.n_regionkey = r_regionkey</span>
<span class="go"> :         JOIN supplier ON s_suppkey = l_suppkey</span>
<span class="go"> :         JOIN nation n2 ON s_nationkey = n2.n_nationkey</span>
<span class="go"> :       WHERE o_orderdate BETWEEN &#39;1995-01-01&#39; AND &#39;1996-12-31&#39;) AS all_nations</span>
<span class="go"> : GROUP BY o_year</span>
<span class="go"> : ORDER BY o_year</span>
<span class="go"> : 1,PushToNetworkQueue  ,2,1,2,2020-09-04 18:32:50,-1,,,,0.27</span>
<span class="go"> : 2,Rechunk             ,2,1,2,2020-09-04 18:32:50,1,,,,0.00</span>
<span class="go"> : 3,SortMerge           ,2,1,2,2020-09-04 18:32:49,2,,,,0.00</span>
<span class="go"> : 4,GpuToCpu            ,2,1,2,2020-09-04 18:32:49,3,,,,0.00</span>
<span class="go"> : 5,Sort                ,2,1,2,2020-09-04 18:32:49,4,,,,0.00</span>
<span class="go"> : 6,ReorderInput        ,2,1,2,2020-09-04 18:32:49,5,,,,0.00</span>
<span class="go"> : 7,GpuTransform        ,2,1,2,2020-09-04 18:32:49,6,,,,0.00</span>
<span class="go"> : 8,CpuToGpu            ,2,1,2,2020-09-04 18:32:49,7,,,,0.00</span>
<span class="go"> : 9,Rechunk             ,2,1,2,2020-09-04 18:32:49,8,,,,0.00</span>
<span class="go"> : 10,ReduceMerge         ,2,1,2,2020-09-04 18:32:49,9,,,,0.03</span>
<span class="go"> : 11,GpuToCpu            ,6,3,2,2020-09-04 18:32:49,10,,,,0.00</span>
<span class="go"> : 12,Reduce              ,6,3,2,2020-09-04 18:32:49,11,,,,0.64</span>
<span class="go"> [...]</span>
<span class="hll"><span class="go"> : 49,LoopJoin            ,182369485,7,26052783,2020-09-04 18:32:36,48,1915MB,1915MB,inner,4.94</span>
</span><span class="go"> [...]</span>
<span class="hll"><span class="go"> : 98,LoopJoin            ,182369485,12,15197457,2020-09-04 18:32:16,97,2191MB,2191MB,inner,5.01</span>
</span><span class="go"> [...]</span>
<span class="hll"><span class="go"> : 124,LoopJoin            ,182369485,8,22796185,2020-09-04 18:32:03,123,3064MB,3064MB,inner,6.73</span>
</span><span class="go"> [...]</span>
<span class="hll"><span class="go"> : 150,LoopJoin            ,182369485,10,18236948,2020-09-04 18:31:47,149,12860MB,12860MB,inner,23.62</span>
</span><span class="go"> [...]</span>
<span class="go"> : 199,ReadTable           ,20000000,1,20000000,2020-09-04 18:30:33,198,0MB,,public.part,0.83</span>
</pre></div>
</div>
<p>Because of the relatively low amount of RAM in the machine and because the data set is rather large at around 10TB, SQream DB needs to spool.</p>
<p>The total spool used by this query is around 20GB (1915MB + 2191MB + 3064MB + 12860MB).</p>
</li>
</ol>
</section>
<section id="common-solutions-for-reducing-spool">
<h4><a class="toc-backref" href="#id47">Common Solutions for Reducing Spool</a><a class="headerlink" href="#common-solutions-for-reducing-spool" title="Permalink to this heading"></a></h4>
<ul>
<li><p>Increase the amount of spool memory available for the workers, as a proportion of the maximum statement memory.
When the amount of spool memory is increased, SQream DB may not need to write to disk.</p>
<p>This setting is called <code class="docutils literal notranslate"><span class="pre">spoolMemoryGB</span></code>. Refer to the <span class="xref std std-ref">configuration</span> guide.</p>
</li>
<li><p>Reduce the amount of <strong>workers</strong> per host, and increase the amount of spool available to the (now reduced amount of) active workers.
This may reduce the amount of concurrent statements, but will improve performance for heavy statements.</p></li>
</ul>
</section>
</section>
<section id="queries-with-large-result-sets">
<h3><a class="toc-backref" href="#id48">2. Queries with Large Result Sets</a><a class="headerlink" href="#queries-with-large-result-sets" title="Permalink to this heading"></a></h3>
<p>When queries have large result sets, you may see a node called <code class="docutils literal notranslate"><span class="pre">DeferredGather</span></code>.
This gathering occurs when the result set is assembled, in preparation for sending it to the client.</p>
<section id="id3">
<h4><a class="toc-backref" href="#id49">Identifying the Offending Nodes</a><a class="headerlink" href="#id3" title="Permalink to this heading"></a></h4>
<ol class="arabic">
<li><p>Run a query.</p>
<p>For example, a modified query from the TPC-H benchmark:</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">s</span><span class="mf">.</span><span class="o">*</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">l</span><span class="mf">.</span><span class="o">*</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">r</span><span class="mf">.</span><span class="o">*</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">n1</span><span class="mf">.</span><span class="o">*</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">n2</span><span class="mf">.</span><span class="o">*</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">p</span><span class="mf">.</span><span class="o">*</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">o</span><span class="mf">.</span><span class="o">*</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">c</span><span class="mf">.</span><span class="o">*</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">lineitem</span><span class="w"> </span><span class="n">l</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p_partkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="w"> </span><span class="p">(</span><span class="n">l_partkey</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">l_orderkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o_orderkey</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o_custkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c_custkey</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n1</span><span class="mf">.</span><span class="n">n_nationkey</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">n1</span><span class="mf">.</span><span class="n">n_regionkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_regionkey</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">supplier</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s_suppkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l_suppkey</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n2</span><span class="mf">.</span><span class="n">n_nationkey</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">r_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AMERICA&#39;</span><span class="w"></span>
<span class="k">AND</span><span class="w">   </span><span class="n">o_orderdate</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;1995-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;1996-12-31&#39;</span><span class="w"></span>
<span class="k">AND</span><span class="w">   </span><span class="n">high_selectivity</span><span class="p">(</span><span class="n">p_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ECONOMY BURNISHED NICKEL&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Observe the execution information by using the foreign table, or use <code class="docutils literal notranslate"><span class="pre">show_node_info</span></code></p>
<p>This statement is made up of 221 nodes, containing 8 <code class="docutils literal notranslate"><span class="pre">ReadTable</span></code> nodes, and finishes by returning billions of results to the client.</p>
<p>The execution below has been shortened, but note the highlighted rows for <code class="docutils literal notranslate"><span class="pre">DeferredGather</span></code>:</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">show_node_info</span><span class="p">(</span><span class="mf">494</span><span class="p">);</span><span class="w"></span>
<span class="go">stmt_id | node_id | node_type            | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read    | write | comment         | timeSum</span>
<span class="go">--------+---------+----------------------+-----------+--------+-------------------+---------------------+----------------+---------+-------+-----------------+--------</span>
<span class="go">    494 |       1 | PushToNetworkQueue   |    242615 |      1 |            242615 | 2020-09-04 19:07:55 |             -1 |         |       |                 |    0.36</span>
<span class="go">    494 |       2 | Rechunk              |    242615 |      1 |            242615 | 2020-09-04 19:07:55 |              1 |         |       |                 |       0</span>
<span class="go">    494 |       3 | ReorderInput         |    242615 |      1 |            242615 | 2020-09-04 19:07:55 |              2 |         |       |                 |       0</span>
<span class="hll"><span class="go">    494 |       4 | DeferredGather       |    242615 |      1 |            242615 | 2020-09-04 19:07:55 |              3 |         |       |                 |    0.16</span>
</span><span class="go">    [...]</span>
<span class="hll"><span class="go">    494 |     166 | DeferredGather       |   3998730 |     39 |            102531 | 2020-09-04 19:07:47 |            165 |         |       |                 |   21.75</span>
</span><span class="go">    [...]</span>
<span class="hll"><span class="go">    494 |     194 | DeferredGather       |    133241 |     20 |              6662 | 2020-09-04 19:07:03 |            193 |         |       |                 |    0.41</span>
</span><span class="go">    [...]</span>
<span class="go">    494 |     221 | ReadTable            |  20000000 |     20 |           1000000 | 2020-09-04 19:07:01 |            220 | 20MB    |       | public.part     |     0.1</span>
</pre></div>
</div>
<p>When you see <code class="docutils literal notranslate"><span class="pre">DeferredGather</span></code> operations taking more than a few seconds, that’s a sign that you’re selecting too much data.
In this case, the DeferredGather with node ID 166 took over 21 seconds.</p>
</li>
<li><p>Modify the statement to see the difference
Altering the select clause to be more restrictive will reduce the deferred gather time back to a few milliseconds.</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">o_orderdate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o_year</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">l_extendedprice</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l_discount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">volume</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">n2</span><span class="mf">.</span><span class="n">n_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nation</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="mf">...</span><span class="w"></span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="common-solutions-for-reducing-gather-time">
<h4><a class="toc-backref" href="#id50">Common Solutions for Reducing Gather Time</a><a class="headerlink" href="#common-solutions-for-reducing-gather-time" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>Reduce the effect of the preparation time. Avoid selecting unnecessary columns (<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM...</span></code>), or reduce the result set size by using more filters.</p></li>
</ul>
</section>
</section>
<section id="inefficient-filtering">
<h3><a class="toc-backref" href="#id51">3. Inefficient Filtering</a><a class="headerlink" href="#inefficient-filtering" title="Permalink to this heading"></a></h3>
<p>When running statements, SQream DB tries to avoid reading data that is not needed for the statement by <span class="xref std std-ref">skipping chunks</span>.
If statements do not include efficient filtering, SQream DB will read a lot of data off disk.
In some cases, you need the data and there’s nothing to do about it. However, if most of it gets pruned further down the line,
it may be efficient to skip reading the data altogether by using the <span class="xref std std-ref">metadata</span>.</p>
<section id="identifying-the-situation">
<h4><a class="toc-backref" href="#id52">Identifying the Situation</a><a class="headerlink" href="#identifying-the-situation" title="Permalink to this heading"></a></h4>
<p>We consider the filtering to be inefficient when the <code class="docutils literal notranslate"><span class="pre">Filter</span></code> node shows that the number of rows processed is less
than a third of the rows passed into it by the <code class="docutils literal notranslate"><span class="pre">ReadTable</span></code> node.
For example:
#.</p>
<blockquote>
<div><p>Run a query.</p>
<p>In this example, we execute a modified query from the TPC-H benchmark.
Our <code class="docutils literal notranslate"><span class="pre">lineitem</span></code> table contains 600,037,902 rows.</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o_year</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;BRAZIL&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mkt_share</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">datepart</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="n">o_orderdate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o_year</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="n">l_extendedprice</span><span class="o">*</span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l_discount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">volume</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="n">n2</span><span class="mf">.</span><span class="n">n_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nation</span><span class="w"></span>
<span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="n">lineitem</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p_partkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="w"> </span><span class="p">(</span><span class="n">l_partkey</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">l_orderkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o_orderkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o_custkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c_custkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n1</span><span class="mf">.</span><span class="n">n_nationkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">n1</span><span class="mf">.</span><span class="n">n_regionkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_regionkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">supplier</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s_suppkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l_suppkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n2</span><span class="mf">.</span><span class="n">n_nationkey</span><span class="w"></span>
<span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">r_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AMERICA&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">lineitem</span><span class="mf">.</span><span class="n">l_quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">o_orderdate</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;1995-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;1996-12-31&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">high_selectivity</span><span class="p">(</span><span class="n">p_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ECONOMY BURNISHED NICKEL&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">all_nations</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o_year</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o_year</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic">
<li><p>Observe the execution information by using the foreign table, or use <code class="docutils literal notranslate"><span class="pre">show_node_info</span></code></p>
<p>The execution below has been shortened, but note the highlighted rows for <code class="docutils literal notranslate"><span class="pre">ReadTable</span></code> and <code class="docutils literal notranslate"><span class="pre">Filter</span></code>:</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">show_node_info</span><span class="p">(</span><span class="mf">559</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 2</span><span class="go">stmt_id | node_id | node_type            | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read   | write | comment         | timeSum</span>
<span class="linenos"> 3</span><span class="go">--------+---------+----------------------+-----------+--------+-------------------+---------------------+----------------+--------+-------+-----------------+--------</span>
<span class="linenos"> 4</span><span class="go">    559 |       1 | PushToNetworkQueue   |         2 |      1 |                 2 | 2020-09-07 11:12:01 |             -1 |        |       |                 |    0.28</span>
<span class="linenos"> 5</span><span class="go">    559 |       2 | Rechunk              |         2 |      1 |                 2 | 2020-09-07 11:12:01 |              1 |        |       |                 |       0</span>
<span class="linenos"> 6</span><span class="go">    559 |       3 | SortMerge            |         2 |      1 |                 2 | 2020-09-07 11:12:01 |              2 |        |       |                 |       0</span>
<span class="linenos"> 7</span><span class="go">    559 |       4 | GpuToCpu             |         2 |      1 |                 2 | 2020-09-07 11:12:01 |              3 |        |       |                 |       0</span>
<span class="linenos"> 8</span><span class="go">[...]</span>
<span class="hll"><span class="linenos"> 9</span><span class="go">    559 |     189 | Filter               |  12007447 |     12 |           1000620 | 2020-09-07 11:12:00 |            188 |        |       |                 |     0.3</span>
</span><span class="linenos">10</span><span class="go">    559 |     190 | GpuTransform         | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            189 |        |       |                 |    0.02</span>
<span class="linenos">11</span><span class="go">    559 |     191 | GpuDecompress        | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            190 |        |       |                 |    0.16</span>
<span class="linenos">12</span><span class="go">    559 |     192 | GpuTransform         | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            191 |        |       |                 |    0.02</span>
<span class="linenos">13</span><span class="go">    559 |     193 | CpuToGpu             | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            192 |        |       |                 |    1.47</span>
<span class="linenos">14</span><span class="go">    559 |     194 | ReorderInput         | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            193 |        |       |                 |       0</span>
<span class="linenos">15</span><span class="go">    559 |     195 | Rechunk              | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            194 |        |       |                 |       0</span>
<span class="linenos">16</span><span class="go">    559 |     196 | CpuDecompress        | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            195 |        |       |                 |       0</span>
<span class="hll"><span class="linenos">17</span><span class="go">    559 |     197 | ReadTable            | 600037902 |     12 |          50003158 | 2020-09-07 11:12:00 |            196 | 7587MB |       | public.lineitem |     0.1</span>
</span><span class="linenos">18</span><span class="go">[...]</span>
<span class="hll"><span class="linenos">19</span><span class="go">    559 |     208 | Filter               |    133241 |     20 |              6662 | 2020-09-07 11:11:57 |            207 |        |       |                 |    0.01</span>
</span><span class="linenos">20</span><span class="go">    559 |     209 | GpuTransform         |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            208 |        |       |                 |    0.02</span>
<span class="linenos">21</span><span class="go">    559 |     210 | GpuDecompress        |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            209 |        |       |                 |    0.03</span>
<span class="linenos">22</span><span class="go">    559 |     211 | GpuTransform         |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            210 |        |       |                 |       0</span>
<span class="linenos">23</span><span class="go">    559 |     212 | CpuToGpu             |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            211 |        |       |                 |    0.01</span>
<span class="linenos">24</span><span class="go">    559 |     213 | ReorderInput         |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            212 |        |       |                 |       0</span>
<span class="linenos">25</span><span class="go">    559 |     214 | Rechunk              |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            213 |        |       |                 |       0</span>
<span class="linenos">26</span><span class="go">    559 |     215 | CpuDecompress        |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            214 |        |       |                 |       0</span>
<span class="hll"><span class="linenos">27</span><span class="go">    559 |     216 | ReadTable            |  20000000 |     20 |           1000000 | 2020-09-07 11:11:57 |            215 | 20MB   |       | public.part     |       0</span>
</span></pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Filter</span></code> on line 9 has processed 12,007,447 rows, but the output of <code class="docutils literal notranslate"><span class="pre">ReadTable</span></code> on <code class="docutils literal notranslate"><span class="pre">public.lineitem</span></code>
on line 17 was 600,037,902 rows. This means that it has filtered out 98% (<span class="math notranslate nohighlight">\(1 - \dfrac{600037902}{12007447} = 98\%\)</span>)
of the data, but the entire table was read.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Filter</span></code> on line 19 has processed 133,000 rows, but the output of <code class="docutils literal notranslate"><span class="pre">ReadTable</span></code> on <code class="docutils literal notranslate"><span class="pre">public.part</span></code>
on line 27 was 20,000,000 rows.  This means that it has filtered out &gt;99% (<span class="math notranslate nohighlight">\(1 - \dfrac{133241}{20000000} = 99.4\%\)</span>)
of the data, but the entire table was read. However, this table is small enough that we can ignore it.</p></li>
</ul>
</li>
<li><p>Modify the statement to see the difference
Altering the statement to have a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> condition on the clustered <code class="docutils literal notranslate"><span class="pre">l_orderkey</span></code> column of the <code class="docutils literal notranslate"><span class="pre">lineitem</span></code> table will help SQream DB skip reading the data.</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o_year</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;BRAZIL&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mkt_share</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">datepart</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="n">o_orderdate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o_year</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="n">l_extendedprice</span><span class="o">*</span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l_discount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">volume</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="n">n2</span><span class="mf">.</span><span class="n">n_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nation</span><span class="w"></span>
<span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="n">lineitem</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p_partkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="w"> </span><span class="p">(</span><span class="n">l_partkey</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">l_orderkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o_orderkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o_custkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c_custkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n1</span><span class="mf">.</span><span class="n">n_nationkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">n1</span><span class="mf">.</span><span class="n">n_regionkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_regionkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">supplier</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s_suppkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l_suppkey</span><span class="w"></span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nation</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n2</span><span class="mf">.</span><span class="n">n_nationkey</span><span class="w"></span>
<span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">r_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AMERICA&#39;</span><span class="w"></span>
<span class="hll"><span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">lineitem</span><span class="mf">.</span><span class="n">l_orderkey</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">4500000</span><span class="w"></span>
</span><span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">o_orderdate</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;1995-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;1996-12-31&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">high_selectivity</span><span class="p">(</span><span class="n">p_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ECONOMY BURNISHED NICKEL&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">all_nations</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o_year</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o_year</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">show_node_info</span><span class="p">(</span><span class="mf">586</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 2</span><span class="go">stmt_id | node_id | node_type            | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read   | write | comment         | timeSum</span>
<span class="linenos"> 3</span><span class="go">--------+---------+----------------------+-----------+--------+-------------------+---------------------+----------------+--------+-------+-----------------+--------</span>
<span class="linenos"> 4</span><span class="go">[...]</span>
<span class="hll"><span class="linenos"> 5</span><span class="go">    586 |     190 | Filter               | 494621593 |      8 |          61827699 | 2020-09-07 13:20:45 |            189 |        |       |                 |    0.39</span>
</span><span class="linenos"> 6</span><span class="go">    586 |     191 | GpuTransform         | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            190 |        |       |                 |    0.03</span>
<span class="linenos"> 7</span><span class="go">    586 |     192 | GpuDecompress        | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            191 |        |       |                 |    0.26</span>
<span class="linenos"> 8</span><span class="go">    586 |     193 | GpuTransform         | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            192 |        |       |                 |    0.01</span>
<span class="linenos"> 9</span><span class="go">    586 |     194 | CpuToGpu             | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            193 |        |       |                 |    1.86</span>
<span class="linenos">10</span><span class="go">    586 |     195 | ReorderInput         | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            194 |        |       |                 |       0</span>
<span class="linenos">11</span><span class="go">    586 |     196 | Rechunk              | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            195 |        |       |                 |       0</span>
<span class="linenos">12</span><span class="go">    586 |     197 | CpuDecompress        | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            196 |        |       |                 |       0</span>
<span class="hll"><span class="linenos">13</span><span class="go">    586 |     198 | ReadTable            | 494927872 |      8 |          61865984 | 2020-09-07 13:20:44 |            197 | 6595MB |       | public.lineitem |    0.09</span>
</span><span class="linenos">14</span><span class="go">[...]</span>
</pre></div>
</div>
<p>In this example, the filter processed 494,621,593 rows, while the output of <code class="docutils literal notranslate"><span class="pre">ReadTable</span></code> on <code class="docutils literal notranslate"><span class="pre">public.lineitem</span></code>
was 494,927,872 rows. This means that it has filtered out all but 0.01% (<span class="math notranslate nohighlight">\(1 - \dfrac{494621593}{494927872} = 0.01\%\)</span>)
of the data that was read.</p>
<p>The metadata skipping has performed very well, and has pre-filtered the data for us by pruning unnecessary chunks.</p>
</li>
</ol>
</section>
<section id="common-solutions-for-improving-filtering">
<h4><a class="toc-backref" href="#id53">Common Solutions for Improving Filtering</a><a class="headerlink" href="#common-solutions-for-improving-filtering" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>Use <span class="xref std std-ref">clustering keys and naturally ordered data</span> in your filters.</p></li>
<li><p>Avoid full table scans when possible</p></li>
</ul>
</section>
</section>
<section id="joins-with-text-keys">
<h3><a class="toc-backref" href="#id54">4. Joins with <code class="docutils literal notranslate"><span class="pre">text</span></code> Keys</a><a class="headerlink" href="#joins-with-text-keys" title="Permalink to this heading"></a></h3>
<p>Joins on long text keys do not perform as well as numeric data types or very short text keys.</p>
<section id="id4">
<h4><a class="toc-backref" href="#id55">Identifying the Situation</a><a class="headerlink" href="#id4" title="Permalink to this heading"></a></h4>
<p>When a join is inefficient, you may note that a query spends a lot of time on the <code class="docutils literal notranslate"><span class="pre">Join</span></code> node.
For example, consider these two table structures:</p>
<ol class="arabic">
<li><p>Run a query.</p>
<p>In this example, we will join <code class="docutils literal notranslate"><span class="pre">t_a.fk</span></code> with <code class="docutils literal notranslate"><span class="pre">t_b.id</span></code>, both of which are <code class="docutils literal notranslate"><span class="pre">TEXT(50)</span></code>.</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">AVG</span><span class="p">(</span><span class="n">t_b</span><span class="mf">.</span><span class="n">j</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">),</span><span class="w"></span>
<span class="w">       </span><span class="n">t_a</span><span class="mf">.</span><span class="n">country_code</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">t_a</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">t_b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="n">t_a</span><span class="mf">.</span><span class="n">fk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_b</span><span class="mf">.</span><span class="n">id</span><span class="p">)</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">t_a</span><span class="mf">.</span><span class="n">country_code</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Observe the execution information by using the foreign table, or use <code class="docutils literal notranslate"><span class="pre">show_node_info</span></code></p>
<p>The execution below has been shortened, but note the highlighted rows for <code class="docutils literal notranslate"><span class="pre">Join</span></code>.
The <code class="docutils literal notranslate"><span class="pre">Join</span></code> node is by far the most time-consuming part of this statement - clocking in at 69.7 seconds
joining 1.5 billion records.</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">show_node_info</span><span class="p">(</span><span class="mf">5</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 2</span><span class="go">stmt_id | node_id | node_type            | rows       | chunks | avg_rows_in_chunk | time                | parent_node_id | read  | write | comment    | timeSum</span>
<span class="linenos"> 3</span><span class="go">--------+---------+----------------------+------------+--------+-------------------+---------------------+----------------+-------+-------+------------+--------</span>
<span class="linenos"> 4</span><span class="go">[...]</span>
<span class="linenos"> 5</span><span class="go">      5 |      19 | GpuTransform         | 1497366528 |    204 |           7340032 | 2020-09-08 18:29:03 |             18 |       |       |            |    1.46</span>
<span class="linenos"> 6</span><span class="go">      5 |      20 | ReorderInput         | 1497366528 |    204 |           7340032 | 2020-09-08 18:29:03 |             19 |       |       |            |       0</span>
<span class="linenos"> 7</span><span class="go">      5 |      21 | ReorderInput         | 1497366528 |    204 |           7340032 | 2020-09-08 18:29:03 |             20 |       |       |            |       0</span>
<span class="hll"><span class="linenos"> 8</span><span class="go">      5 |      22 | Join                 | 1497366528 |    204 |           7340032 | 2020-09-08 18:29:03 |             21 |       |       | inner      |    69.7</span>
</span><span class="linenos"> 9</span><span class="go">      5 |      24 | AddSortedMinMaxMet.. |    6291456 |      1 |           6291456 | 2020-09-08 18:26:05 |             22 |       |       |            |       0</span>
<span class="linenos">10</span><span class="go">      5 |      25 | Sort                 |    6291456 |      1 |           6291456 | 2020-09-08 18:26:05 |             24 |       |       |            |    2.06</span>
<span class="linenos">11</span><span class="go">[...]</span>
<span class="linenos">12</span><span class="go">      5 |      31 | ReadTable            |    6291456 |      1 |           6291456 | 2020-09-08 18:26:03 |             30 | 235MB |       | public.t_b |    0.02</span>
<span class="linenos">13</span><span class="go">[...]</span>
<span class="linenos">14</span><span class="go">      5 |      41 | CpuDecompress        |   10000000 |      2 |           5000000 | 2020-09-08 18:26:09 |             40 |       |       |            |       0</span>
<span class="linenos">15</span><span class="go">      5 |      42 | ReadTable            |   10000000 |      2 |           5000000 | 2020-09-08 18:26:09 |             41 | 14MB  |       | public.t_a |       0</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="improving-query-performance">
<h4><a class="toc-backref" href="#id56">Improving Query Performance</a><a class="headerlink" href="#improving-query-performance" title="Permalink to this heading"></a></h4>
<ul>
<li><p>In general, try to avoid <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> as a join key. As a rule of thumb, <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code> works best as a join key.</p></li>
<li><p>Convert text values on-the-fly before running the query. For example, the <a class="reference internal" href="../reference/sql/sql_functions/scalar_functions/numeric/crc64.html#crc64"><span class="std std-ref">CRC64</span></a> function takes a text
input and returns a <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code> hash.</p>
<p>For example:</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">AVG</span><span class="p">(</span><span class="n">t_b</span><span class="mf">.</span><span class="n">j</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">),</span><span class="w"></span>
<span class="w">      </span><span class="n">t_a</span><span class="mf">.</span><span class="n">country_code</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">t_a</span><span class="w"></span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">t_b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="n">crc64_join</span><span class="p">(</span><span class="n">t_a</span><span class="mf">.</span><span class="n">fk</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crc64_join</span><span class="p">(</span><span class="n">t_b</span><span class="mf">.</span><span class="n">id</span><span class="p">))</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">t_a</span><span class="mf">.</span><span class="n">country_code</span><span class="w"></span>
</pre></div>
</div>
<p>The execution below has been shortened, but note the highlighted rows for <code class="docutils literal notranslate"><span class="pre">Join</span></code>.
The <code class="docutils literal notranslate"><span class="pre">Join</span></code> node went from taking nearly 70 seconds, to just 6.67 seconds for joining 1.5 billion records.</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">show_node_info</span><span class="p">(</span><span class="mf">6</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 2</span><span class="go">   stmt_id | node_id | node_type            | rows       | chunks | avg_rows_in_chunk | time                | parent_node_id | read  | write | comment    | timeSum</span>
<span class="linenos"> 3</span><span class="go">   --------+---------+----------------------+------------+--------+-------------------+---------------------+----------------+-------+-------+------------+--------</span>
<span class="linenos"> 4</span><span class="go">   [...]</span>
<span class="linenos"> 5</span><span class="go">         6 |      19 | GpuTransform         | 1497366528 |     85 |          17825792 | 2020-09-08 18:57:04 |             18 |       |       |            |    1.48</span>
<span class="linenos"> 6</span><span class="go">         6 |      20 | ReorderInput         | 1497366528 |     85 |          17825792 | 2020-09-08 18:57:04 |             19 |       |       |            |       0</span>
<span class="linenos"> 7</span><span class="go">         6 |      21 | ReorderInput         | 1497366528 |     85 |          17825792 | 2020-09-08 18:57:04 |             20 |       |       |            |       0</span>
<span class="hll"><span class="linenos"> 8</span><span class="go">         6 |      22 | Join                 | 1497366528 |     85 |          17825792 | 2020-09-08 18:57:04 |             21 |       |       | inner      |    6.67</span>
</span><span class="linenos"> 9</span><span class="go">         6 |      24 | AddSortedMinMaxMet.. |    6291456 |      1 |           6291456 | 2020-09-08 18:55:12 |             22 |       |       |            |       0</span>
<span class="linenos">10</span><span class="go">   [...]</span>
<span class="linenos">11</span><span class="go">         6 |      32 | ReadTable            |    6291456 |      1 |           6291456 | 2020-09-08 18:55:12 |             31 | 235MB |       | public.t_b |    0.02</span>
<span class="linenos">12</span><span class="go">   [...]</span>
<span class="linenos">13</span><span class="go">         6 |      43 | CpuDecompress        |   10000000 |      2 |           5000000 | 2020-09-08 18:55:13 |             42 |       |       |            |       0</span>
<span class="linenos">14</span><span class="go">         6 |      44 | ReadTable            |   10000000 |      2 |           5000000 | 2020-09-08 18:55:13 |             43 | 14MB  |       | public.t_a |       0</span>
</pre></div>
</div>
</li>
<li><p>You can map some text values to numeric types by using a dimension table. Then, reconcile the values when you need them by joining the dimension table.</p></li>
</ul>
</section>
</section>
<section id="sorting-on-big-text-fields">
<h3><a class="toc-backref" href="#id57">5. Sorting on big <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> fields</a><a class="headerlink" href="#sorting-on-big-text-fields" title="Permalink to this heading"></a></h3>
<p>In general, SQream DB automatically inserts a <code class="docutils literal notranslate"><span class="pre">Sort</span></code> node which arranges the data prior to reductions and aggregations.
When running a <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> on large <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> fields, you may see nodes for <code class="docutils literal notranslate"><span class="pre">Sort</span></code> and <code class="docutils literal notranslate"><span class="pre">Reduce</span></code> taking a long time.</p>
<section id="id5">
<h4><a class="toc-backref" href="#id58">Identifying the Situation</a><a class="headerlink" href="#id5" title="Permalink to this heading"></a></h4>
<p>When running a statement, inspect it with <a class="reference internal" href="../reference/sql/sql_statements/utility_commands/show_node_info.html#show-node-info"><span class="std std-ref">SHOW_NODE_INFO</span></a>. If you see <code class="docutils literal notranslate"><span class="pre">Sort</span></code> and <code class="docutils literal notranslate"><span class="pre">Reduce</span></code> among
your top five longest running nodes, there is a potential issue.
For example:
#.</p>
<blockquote>
<div><p>Run a query to test it out.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">t_inefficient</span></code> table contains 60,000,000 rows, and the structure is simple, but with an oversized <code class="docutils literal notranslate"><span class="pre">country_code</span></code> column:</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t_inefficient</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">   </span><span class="n">i</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="n">amt</span><span class="w"> </span><span class="k">DOUBLE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="n">ts</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="w">   </span><span class="n">country_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">(</span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
</span><span class="w">   </span><span class="n">flag</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="n">string_fk</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">(</span><span class="mf">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>We will run a query, and inspect it’s execution details:</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">country_code</span><span class="p">,</span><span class="w"></span>
<span class="mf">.</span><span class="w">          </span><span class="n">SUM</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span><span class="w"></span>
<span class="mf">.</span><span class="w">   </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_inefficient</span><span class="w"></span>
<span class="mf">.</span><span class="w">   </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country_code</span><span class="p">;</span><span class="w"></span>
<span class="go">executed</span>
<span class="go">time: 47.55s</span>

<span class="go">country_code | sum</span>
<span class="go">-------------+-----------</span>
<span class="go">VUT          | 1195416012</span>
<span class="go">GIB          | 1195710372</span>
<span class="go">TUR          | 1195946178</span>
<span class="go">[...]</span>
</pre></div>
</div>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">show_node_info</span><span class="p">(</span><span class="mf">30</span><span class="p">);</span><span class="w"></span>
<span class="go">stmt_id | node_id | node_type          | rows     | chunks | avg_rows_in_chunk | time                | parent_node_id | read  | write | comment              | timeSum</span>
<span class="go">--------+---------+--------------------+----------+--------+-------------------+---------------------+----------------+-------+-------+----------------------+--------</span>
<span class="go">     30 |       1 | PushToNetworkQueue |      249 |      1 |               249 | 2020-09-10 16:17:10 |             -1 |       |       |                      |    0.25</span>
<span class="go">     30 |       2 | Rechunk            |      249 |      1 |               249 | 2020-09-10 16:17:10 |              1 |       |       |                      |       0</span>
<span class="go">     30 |       3 | ReduceMerge        |      249 |      1 |               249 | 2020-09-10 16:17:10 |              2 |       |       |                      |    0.01</span>
<span class="go">     30 |       4 | GpuToCpu           |     1508 |     15 |               100 | 2020-09-10 16:17:10 |              3 |       |       |                      |       0</span>
<span class="hll"><span class="go">     30 |       5 | Reduce             |     1508 |     15 |               100 | 2020-09-10 16:17:10 |              4 |       |       |                      |    7.23</span>
</span><span class="hll"><span class="go">     30 |       6 | Sort               | 60000000 |     15 |           4000000 | 2020-09-10 16:17:10 |              5 |       |       |                      |    36.8</span>
</span><span class="go">     30 |       7 | GpuTransform       | 60000000 |     15 |           4000000 | 2020-09-10 16:17:10 |              6 |       |       |                      |    0.08</span>
<span class="go">     30 |       8 | GpuDecompress      | 60000000 |     15 |           4000000 | 2020-09-10 16:17:10 |              7 |       |       |                      |    2.01</span>
<span class="go">     30 |       9 | CpuToGpu           | 60000000 |     15 |           4000000 | 2020-09-10 16:17:10 |              8 |       |       |                      |    0.16</span>
<span class="go">     30 |      10 | Rechunk            | 60000000 |     15 |           4000000 | 2020-09-10 16:17:10 |              9 |       |       |                      |       0</span>
<span class="go">     30 |      11 | CpuDecompress      | 60000000 |     15 |           4000000 | 2020-09-10 16:17:10 |             10 |       |       |                      |       0</span>
<span class="go">     30 |      12 | ReadTable          | 60000000 |     15 |           4000000 | 2020-09-10 16:17:10 |             11 | 520MB |       | public.t_inefficient |    0.05</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic">
<li><p>We can look to see if there’s any shrinking we can do on the <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> key</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MAX</span><span class="p">(</span><span class="n">LEN</span><span class="p">(</span><span class="n">country_code</span><span class="p">))</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_inefficient</span><span class="p">;</span><span class="w"></span>
<span class="go">max</span>
<span class="go">---</span>
<span class="go">3</span>
</pre></div>
</div>
<p>With a maximum string length of just 3 characters, our <code class="docutils literal notranslate"><span class="pre">TEXT(100)</span></code> is way oversized.</p>
</li>
<li><p>We can recreate the table with a more restrictive <code class="docutils literal notranslate"><span class="pre">TEXT(3)</span></code>, and can examine the difference in performance:</p>
<p>This time, the entire query took just 4.75 seconds, or just about 91% faster.</p>
</li>
</ol>
</section>
<section id="improving-sort-performance-on-text-keys">
<h4><a class="toc-backref" href="#id59">Improving Sort Performance on Text Keys</a><a class="headerlink" href="#improving-sort-performance-on-text-keys" title="Permalink to this heading"></a></h4>
<p>When using TEXT, ensure that the maximum length defined in the table structure is as small as necessary.
For example, if you’re storing phone numbers, don’t define the field as <code class="docutils literal notranslate"><span class="pre">TEXT(255)</span></code>, as that affects sort performance.</p>
<p>You can run a query to get the maximum column length (e.g. <code class="docutils literal notranslate"><span class="pre">MAX(LEN(a_column))</span></code>), and potentially modify the table structure.</p>
</section>
</section>
<section id="high-selectivity-data">
<span id="high-selectivity-data-opt"></span><h3><a class="toc-backref" href="#id60">6. High Selectivity Data</a><a class="headerlink" href="#high-selectivity-data" title="Permalink to this heading"></a></h3>
<p>Selectivity is the ratio of cardinality to the number of records of a chunk. We define selectivity as <span class="math notranslate nohighlight">\(\frac{\text{Distinct values}}{\text{Total number of records in a chunk}}\)</span>
SQream DB has a hint called <code class="docutils literal notranslate"><span class="pre">HIGH_SELECTIVITY</span></code>, which is a function you can wrap a condition in.
The hint signals to SQream DB that the result of the condition will be very sparse, and that it should attempt to rechunk
the results into fewer, fuller chunks.
.. note:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SQream</span> <span class="n">DB</span> <span class="n">doesn</span><span class="s1">&#39;t do this automatically because it adds a significant overhead on naturally ordered and</span>
<span class="n">well</span><span class="o">-</span><span class="n">clustered</span> <span class="n">data</span><span class="p">,</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">more</span> <span class="n">common</span> <span class="n">scenario</span><span class="o">.</span>
</pre></div>
</div>
<section id="id6">
<h4><a class="toc-backref" href="#id61">Identifying the Situation</a><a class="headerlink" href="#id6" title="Permalink to this heading"></a></h4>
<p>This is easily identifiable - when the amount of average of rows in a chunk is small, following a <code class="docutils literal notranslate"><span class="pre">Filter</span></code> operation.
Consider this execution plan:</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">show_node_info</span><span class="p">(</span><span class="mf">30</span><span class="p">);</span><span class="w"></span>
<span class="go">stmt_id | node_id | node_type         | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read  | write | comment    | timeSum</span>
<span class="go">--------+---------+-------------------+-----------+--------+-------------------+---------------------+----------------+-------+-------+------------+--------</span>
<span class="go">[...]</span>
<span class="go">     30 |      38 | Filter            |     18160 |     74 |               245 | 2020-09-10 12:17:09 |             37 |       |       |            |   0.012</span>
<span class="go">[...]</span>
<span class="go">     30 |      44 | ReadTable         |  77000000 |     74 |           1040540 | 2020-09-10 12:17:09 |             43 | 277MB |       | public.dim |   0.058</span>
</pre></div>
</div>
<p>The table was read entirely - 77 million rows into 74 chunks.
The filter node reduced the output to just 18,160 relevant rows, but they’re distributed across the original 74 chunks.
All of these rows could fit in one single chunk, instead of spanning 74 rather sparse chunks.</p>
</section>
<section id="improving-performance-with-high-selectivity-hints">
<h4><a class="toc-backref" href="#id62">Improving Performance with High Selectivity Hints</a><a class="headerlink" href="#improving-performance-with-high-selectivity-hints" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>Use when there’s a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> condition on an <span class="xref std std-ref">unclustered column</span>, and when you expect the filter
to cut out more than 60% of the result set.</p></li>
<li><p>Use when the data is uniformly distributed or random</p></li>
</ul>
</section>
</section>
<section id="performance-of-unsorted-data-in-joins">
<h3><a class="toc-backref" href="#id63">7. Performance of unsorted data in joins</a><a class="headerlink" href="#performance-of-unsorted-data-in-joins" title="Permalink to this heading"></a></h3>
<p>When data is not well-clustered or naturally ordered, a join operation can take a long time.</p>
<section id="id7">
<h4><a class="toc-backref" href="#id64">Identifying the Situation</a><a class="headerlink" href="#id7" title="Permalink to this heading"></a></h4>
<p>When running a statement, inspect it with <a class="reference internal" href="../reference/sql/sql_statements/utility_commands/show_node_info.html#show-node-info"><span class="std std-ref">SHOW_NODE_INFO</span></a>. If you see <code class="docutils literal notranslate"><span class="pre">Join</span></code> and <code class="docutils literal notranslate"><span class="pre">DeferredGather</span></code> among your
top five longest running nodes, there is a potential issue.
In this case, we’re also interested in the number of chunks produced by these nodes.</p>
<p>Consider this execution plan:</p>
<div class="highlight-psql notranslate"><div class="highlight"><pre><span></span><span class="gp">t=&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">show_node_info</span><span class="p">(</span><span class="mf">30</span><span class="p">);</span><span class="w"></span>
<span class="go">stmt_id | node_id | node_type         | rows      | chunks | avg_rows_in_chunk | time                | parent_node_id | read  | write | comment    | timeSum</span>
<span class="go">--------+---------+-------------------+-----------+--------+-------------------+---------------------+----------------+-------+-------+------------+--------</span>
<span class="go">[...]</span>
<span class="go">     30 |      13 | ReorderInput      | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             12 |       |       |            |   4.681</span>
<span class="hll"><span class="go">     30 |      14 | DeferredGather    | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             13 |       |       |            |  29.901</span>
</span><span class="go">     30 |      15 | ReorderInput      | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             14 |       |       |            |   3.053</span>
<span class="go">     30 |      16 | GpuToCpu          | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             15 |       |       |            |   5.798</span>
<span class="go">     30 |      17 | ReorderInput      | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             16 |       |       |            |   2.899</span>
<span class="go">     30 |      18 | ReorderInput      | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             17 |       |       |            |   3.695</span>
<span class="hll"><span class="go">     30 |      19 | Join              | 181582598 |  70596 |              2572 | 2020-09-10 12:17:10 |             18 |       |       | inner      |  22.745</span>
</span><span class="go">[...]</span>
<span class="go">     30 |      38 | Filter            |     18160 |     74 |               245 | 2020-09-10 12:17:09 |             37 |       |       |            |   0.012</span>
<span class="go">[...]</span>
<span class="go">     30 |      44 | ReadTable         |  77000000 |     74 |           1040540 | 2020-09-10 12:17:09 |             43 | 277MB |       | public.dim |   0.058</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Join</span></code> is the node that matches rows from both table relations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DeferredGather</span></code> gathers the required column chunks to decompress</p></li>
</ul>
<p>Pay special attention to the volume of data removed by the <code class="docutils literal notranslate"><span class="pre">Filter</span></code> node.
The table was read entirely - 77 million rows into 74 chunks.
The filter node reduced the output to just 18,160 relevant rows, but they’re distributed across the original 74 chunks.
All of these rows could fit in one single chunk, instead of spanning 74 rather sparse chunks.</p>
</section>
<section id="improving-join-performance-when-data-is-sparse">
<h4><a class="toc-backref" href="#id65">Improving Join Performance when Data is Sparse</a><a class="headerlink" href="#improving-join-performance-when-data-is-sparse" title="Permalink to this heading"></a></h4>
<p>You can tell SQream DB to reduce the amount of chunks involved, if you know that the filter is going to be quite
agressive by using the <a class="reference internal" href="optimization_best_practices.html#high-selectivity"><span class="std std-ref">HIGH_SELECTIVITY</span></a> hint described <a class="reference internal" href="#high-selectivity-data-opt"><span class="std std-ref">above</span></a>.
This forces the compiler to rechunk the data into fewer chunks.
To tell SQream DB to rechunk the data, wrap a condition (or several) in the <code class="docutils literal notranslate"><span class="pre">HIGH_SELECTIVITY</span></code> hint:</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Without the hint</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">cdrs</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"></span>
<span class="w">      </span><span class="n">RequestReceiveTime</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2018-01-01 00:00:00.000&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2018-08-31 23:59:59.999&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">EnterpriseID</span><span class="o">=</span><span class="mf">1150</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">MSISDN</span><span class="o">=</span><span class="s1">&#39;9724871140341&#39;</span><span class="p">;</span><span class="w"></span>

<span class="c1">-- With the hint</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">cdrs</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"></span>
<span class="hll"><span class="w">      </span><span class="n">HIGH_SELECTIVITY</span><span class="p">(</span><span class="n">RequestReceiveTime</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2018-01-01 00:00:00.000&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2018-08-31 23:59:59.999&#39;</span><span class="p">)</span><span class="w"></span>
</span><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">EnterpriseID</span><span class="o">=</span><span class="mf">1150</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">MSISDN</span><span class="o">=</span><span class="s1">&#39;9724871140341&#39;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="manual-join-reordering">
<h3><a class="toc-backref" href="#id66">8. Manual Join Reordering</a><a class="headerlink" href="#manual-join-reordering" title="Permalink to this heading"></a></h3>
<p>When joining multiple tables, you may wish to change the join order to join the smallest tables first.</p>
<section id="id8">
<h4><a class="toc-backref" href="#id67">Identifying the situation</a><a class="headerlink" href="#id8" title="Permalink to this heading"></a></h4>
<p>When joining more than two tables, the <code class="docutils literal notranslate"><span class="pre">Join</span></code> nodes will be the most time-consuming nodes.</p>
</section>
<section id="changing-the-join-order">
<h4><a class="toc-backref" href="#id68">Changing the Join Order</a><a class="headerlink" href="#changing-the-join-order" title="Permalink to this heading"></a></h4>
<p>Always prefer to join the smallest tables first.
.. note:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">We</span> <span class="n">consider</span> <span class="n">small</span> <span class="n">tables</span> <span class="n">to</span> <span class="n">be</span> <span class="n">tables</span> <span class="n">that</span> <span class="n">only</span> <span class="n">retain</span> <span class="n">a</span> <span class="n">small</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">rows</span> <span class="n">after</span> <span class="n">conditions</span>
<span class="n">are</span> <span class="n">applied</span><span class="o">.</span> <span class="n">This</span> <span class="n">bears</span> <span class="n">no</span> <span class="n">direct</span> <span class="n">relation</span> <span class="n">to</span> <span class="n">the</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">total</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">table</span><span class="o">.</span>
</pre></div>
</div>
<p>Changing the join order can reduce the query runtime significantly. In the examples below, we reduce the time
from 27.3 seconds to just 6.4 seconds.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Original query</span><a class="headerlink" href="#id10" title="Permalink to this code"></a></div>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="c1">-- This variant runs in 27.3 seconds</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">l_extendedprice</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l_discount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">c_nationkey</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">lineitem</span><span class="w"> </span><span class="c1">--6B Rows, ~183GB</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="c1">--1.5B Rows, ~55GB</span>
<span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">l_orderkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o_orderkey</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="c1">--150M Rows, ~12GB</span>
<span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">c_custkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o_custkey</span><span class="w"></span>

<span class="k">WHERE</span><span class="w"> </span><span class="n">c_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">o_orderdate</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="s1">&#39;1993-01-01&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">o_orderdate</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;1994-01-01&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">l_shipdate</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;1993-01-01&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">l_shipdate</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">dateadd</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="mf">122</span><span class="p">,</span><span class="s1">&#39;1994-01-01&#39;</span><span class="p">)</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">c_nationkey</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Modified query with improved join order</span><a class="headerlink" href="#id11" title="Permalink to this code"></a></div>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="c1">-- This variant runs in 6.4 seconds</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">l_extendedprice</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l_discount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">c_nationkey</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="c1">--1.5B Rows, ~55GB</span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="c1">--150M Rows, ~12GB</span>
<span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">c_custkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o_custkey</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">lineitem</span><span class="w"> </span><span class="c1">--6B Rows, ~183GB</span>
<span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">l_orderkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o_orderkey</span><span class="w"></span>

<span class="k">WHERE</span><span class="w"> </span><span class="n">c_nationkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">o_orderdate</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="s1">&#39;1993-01-01&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">o_orderdate</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;1994-01-01&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">l_shipdate</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;1993-01-01&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">AND</span><span class="w">   </span><span class="n">l_shipdate</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">dateadd</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="mf">122</span><span class="p">,</span><span class="s1">&#39;1994-01-01&#39;</span><span class="p">)</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">c_nationkey</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>
<section id="further-reading">
<h2><a class="toc-backref" href="#id44">Further Reading</a><a class="headerlink" href="#further-reading" title="Permalink to this heading"></a></h2>
<p>See our <a class="reference internal" href="optimization_best_practices.html#sql-best-practices"><span class="std std-ref">Optimization and Best Practices</span></a> guide for more information about query optimization and data loading considerations.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="logging.html" class="btn btn-neutral float-left" title="Logging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="security.html" class="btn btn-neutral float-right" title="Security" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 SQream.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>