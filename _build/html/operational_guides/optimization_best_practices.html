<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimization and Best Practices &mdash; SQream Blue 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuration Guides" href="../configuration_guides/index.html" />
    <link rel="prev" title="Seeing System Objects as DDL" href="seeing_system_objects_as_ddl.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #133148" >
            <a href="../index.html">
            <img src="../_static/SQream_logo_without background-15.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/login_and_connectors.html">Login and Connectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/cost_management.html">Cost Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/performing_basic_sqream_operations.html">Performing Basic SQream Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/running_the_sqream_sql_client.html">Running the SQream SQL Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/creating_your_first_table.html">Creating Your First Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/listing_tables.html">Listing Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/inserting_rows.html">Inserting Rows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/running_queries.html">Running Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/saving_query_results_to_a_csv_or_psv_file.html">Saving Query Results to a CSV or PSV File</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/blue_console.html">BLUE Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sql/index.html">SQL Statements and Syntax</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/sql/sql_syntax/index.html">SQL Syntax Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/sql/sql_statements/index.html">SQL Statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/sql/sql_functions/index.html">SQL Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/sql/sql_functions/scalar_functions/index.html">Built-In Scalar Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sql/sql_functions/user_defined_functions/index.html">User-Defined Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sql/sql_functions/aggregate_functions/index.html">Aggregate Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/sql/sql_functions/window_functions/index.html">Window Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sql_feature_support.html">SQL Feature Checklist</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data_type_guides/index.html">Data Type Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../data_type_guides/converting_and_casting_types.html">Converting and Casting Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_type_guides/supported_data_types.html">Supported Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_type_guides/supported_casts.html">Supported Casts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_numeric.html">Numeric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_boolean.html">Boolean</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_integer.html">Integer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_floating_point.html">Floating Point</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_string.html">String</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_type_guides/sql_data_types_date.html">Date</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../file_types/index.html">File Types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../file_types/file_types_overview.html">File Types Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file_types/avro.html">Avro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file_types/csv.html">CSV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file_types/parquet.html">Parquet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file_types/orc.html">ORC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file_types/json.html">JSON</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../feature_guides/index.html">Feature Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/python_functions.html">Python UDF (User-Defined Functions)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/concurrency_and_locks.html">Concurrency and Locks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feature_guides/concurrency_and_scaling_in_sqream.html">Concurrency and Scaling in SQream DB</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Operational Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="access_control.html">Access Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="access_control_overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_control_managing_roles.html">Managing Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_control_permissions.html">Permissions</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_control_password_policy.html">Password Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_control_departmental_example.html">Departmental Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="audit_log_operation.html">Audit Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="exporting_data.html">Exporting Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring_query_performance.html">Monitoring Query Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="seeing_system_objects_as_ddl.html">Seeing System Objects as DDL</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Optimization and Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_guides/index.html">Configuration Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration_guides/bucket/bucket_integration.html">Bucket Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration_guides/spooling.html">Configuring the Spooling Feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration_guides/configuring_sqream.html">Configuring SQream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration_guides/configuration_flags.html">Configuration Flags</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/admin_flags.html">Administration Flags</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../configuration_guides/admin_regular_flags.html">Regular Administration Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration_guides/admin_worker_flags.html">Worker Administration Flags</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../configuration_guides/generic_flags.html">Generic Flags</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../configuration_guides/generic_regular_flags.html">Regular Generic Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration_guides/generic_worker_flags.html">Worker Generic Flags</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../loading_and_unloading_data/index.html">Loading and Unloading Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/remedying_slow_queries.html">Remedying Slow Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/resolving_common_issues.html">Resolving Common Issues</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/lock_related_issues.html">Lock Related Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/information_for_support.html">Gathering Information for SQream Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #133148" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SQream Blue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Operational Guides</a> &raquo;</li>
      <li>Optimization and Best Practices</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimization-and-best-practices">
<span id="sql-best-practices"></span><h1>Optimization and Best Practices<a class="headerlink" href="#optimization-and-best-practices" title="Permalink to this heading"></a></h1>
<p>This topic explains some best practices of working with SQream DB.</p>
<p>See also our <a class="reference internal" href="monitoring_query_performance.html#monitoring-query-performance"><span class="std std-ref">Monitoring Query Performance</span></a> guide for more information.</p>
<div class="contents local topic" id="in-this-topic">
<p class="topic-title">In this topic:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#table-design" id="id5">Table design</a></p>
<ul>
<li><p><a class="reference internal" href="#use-date-and-datetime-types-for-columns" id="id6">Use date and datetime types for columns</a></p></li>
<li><p><a class="reference internal" href="#don-t-flatten-or-denormalize-data" id="id7">Don’t flatten or denormalize data</a></p></li>
<li><p><a class="reference internal" href="#convert-foreign-tables-to-native-tables" id="id8">Convert foreign tables to native tables</a></p></li>
<li><p><a class="reference internal" href="#use-information-about-the-column-data-to-your-advantage" id="id9">Use information about the column data to your advantage</a></p>
<ul>
<li><p><a class="reference internal" href="#set-null-or-not-null-when-relevant" id="id10">Set <code class="docutils literal notranslate"><span class="pre">NULL</span></code> or <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> when relevant</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#sorting" id="id11">Sorting</a></p></li>
<li><p><a class="reference internal" href="#query-best-practices" id="id12">Query best practices</a></p>
<ul>
<li><p><a class="reference internal" href="#reduce-data-sets-before-joining-tables" id="id13">Reduce data sets before joining tables</a></p></li>
<li><p><a class="reference internal" href="#prefer-the-ansi-join" id="id14">Prefer the ANSI JOIN</a></p></li>
<li><p><a class="reference internal" href="#use-the-high-selectivity-hint" id="id15">Use the high selectivity hint</a></p></li>
<li><p><a class="reference internal" href="#cast-smaller-types-to-avoid-overflow-in-aggregates" id="id16">Cast smaller types to avoid overflow in aggregates</a></p></li>
<li><p><a class="reference internal" href="#prefer-count-and-count-on-non-nullable-columns" id="id17">Prefer <code class="docutils literal notranslate"><span class="pre">COUNT(*)</span></code> and <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> on non-nullable columns</a></p></li>
<li><p><a class="reference internal" href="#return-only-required-columns" id="id18">Return only required columns</a></p></li>
<li><p><a class="reference internal" href="#use-saved-queries-to-reduce-recurring-compilation-time" id="id19">Use saved queries to reduce recurring compilation time</a></p></li>
<li><p><a class="reference internal" href="#pre-filter-to-reduce-join-complexity" id="id20">Pre-filter to reduce <a class="reference internal" href="../reference/sql/sql_syntax/joins.html#joins"><span class="std std-ref">JOIN</span></a> complexity</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#data-loading-considerations" id="id21">Data loading considerations</a></p>
<ul>
<li><p><a class="reference internal" href="#allow-and-use-natural-sorting-on-data" id="id22">Allow and use natural sorting on data</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#further-reading-and-monitoring-query-performance" id="id23">Further reading and monitoring query performance</a></p></li>
</ul>
</div>
<section id="table-design">
<span id="table-design-best-practices"></span><h2><a class="toc-backref" href="#id5">Table design</a><a class="headerlink" href="#table-design" title="Permalink to this heading"></a></h2>
<p>This section describes best practices and guidelines for designing tables.</p>
<section id="use-date-and-datetime-types-for-columns">
<h3><a class="toc-backref" href="#id6">Use date and datetime types for columns</a><a class="headerlink" href="#use-date-and-datetime-types-for-columns" title="Permalink to this heading"></a></h3>
<p>When creating tables with dates or timestamps, using the purpose-built <code class="docutils literal notranslate"><span class="pre">DATE</span></code> and <code class="docutils literal notranslate"><span class="pre">DATETIME</span></code> types over integer types or <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> will bring performance and storage footprint improvements, and in many cases huge performance improvements (as well as data integrity benefits). SQream DB stores dates and datetimes very efficiently and can strongly optimize queries using these specific types.</p>
</section>
<section id="don-t-flatten-or-denormalize-data">
<h3><a class="toc-backref" href="#id7">Don’t flatten or denormalize data</a><a class="headerlink" href="#don-t-flatten-or-denormalize-data" title="Permalink to this heading"></a></h3>
<p>SQream DB executes JOIN operations very effectively. It is almost always better to JOIN tables at query-time rather than flatten/denormalize your tables.</p>
<p>This will also reduce storage size and reduce row-lengths.</p>
<p>We highly suggest using <code class="docutils literal notranslate"><span class="pre">INT</span></code> or <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code> as join keys, rather than a text/string type.</p>
</section>
<section id="convert-foreign-tables-to-native-tables">
<h3><a class="toc-backref" href="#id8">Convert foreign tables to native tables</a><a class="headerlink" href="#convert-foreign-tables-to-native-tables" title="Permalink to this heading"></a></h3>
<p>SQream DB’s native storage is heavily optimized for analytic workloads. It is always faster for querying than other formats, even columnar ones such as Parquet. It also enables the use of additional metadata to help speed up queries, in some cases by many orders of magnitude.</p>
<p>You can improve the performance of all operations by converting <a class="reference internal" href="foreign_tables.html#foreign-tables"><span class="std std-ref">foreign tables</span></a> into native tables by using the <a class="reference internal" href="../reference/sql/sql_statements/ddl_commands/create_table_as.html#create-table-as"><span class="std std-ref">CREATE TABLE AS</span></a> syntax.</p>
<p>For example,</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">native_table</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">foreign_table</span><span class="w"></span>
</pre></div>
</div>
<p>The one situation when this wouldn’t be as useful is when data will be only queried once.</p>
</section>
<section id="use-information-about-the-column-data-to-your-advantage">
<h3><a class="toc-backref" href="#id9">Use information about the column data to your advantage</a><a class="headerlink" href="#use-information-about-the-column-data-to-your-advantage" title="Permalink to this heading"></a></h3>
<p>Knowing the data types and their ranges can help design a better table.</p>
<section id="set-null-or-not-null-when-relevant">
<h4><a class="toc-backref" href="#id10">Set <code class="docutils literal notranslate"><span class="pre">NULL</span></code> or <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> when relevant</a><a class="headerlink" href="#set-null-or-not-null-when-relevant" title="Permalink to this heading"></a></h4>
<p>For example, if a value can’t be missing (or <code class="docutils literal notranslate"><span class="pre">NULL</span></code>), specify a <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> constraint on the columns.</p>
<p>Not only does specifying <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> save on data storage, it lets the query compiler know that a column cannot have a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> value, which can improve query performance.</p>
</section>
</section>
</section>
<section id="sorting">
<h2><a class="toc-backref" href="#id11">Sorting</a><a class="headerlink" href="#sorting" title="Permalink to this heading"></a></h2>
<p>Data sorting is an important factor in minimizing storage size and improving query performance.</p>
<ul class="simple">
<li><p>Minimizing storage saves on physical resources and increases performance by reducing overall disk I/O. Prioritize the sorting of low-cardinality columns. This reduces the number of chunks and extents that SQream DB reads during query execution.</p></li>
<li><p>Where possible, sort columns with the lowest cardinality first. Avoid sorting <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> columns with lengths exceeding 50 characters.</p></li>
<li><p>For longer-running queries that run on a regular basis, performance can be improved by sorting data based on the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> and <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> parameters. Data can be sorted during insert by using <a class="reference internal" href="foreign_tables.html#foreign-tables"><span class="std std-ref">Foreign Tables</span></a> or by using <a class="reference internal" href="../reference/sql/sql_statements/ddl_commands/create_table_as.html#create-table-as"><span class="std std-ref">CREATE TABLE AS</span></a>.</p></li>
</ul>
</section>
<section id="query-best-practices">
<span id="id1"></span><h2><a class="toc-backref" href="#id12">Query best practices</a><a class="headerlink" href="#query-best-practices" title="Permalink to this heading"></a></h2>
<p>This section describes best practices for writing SQL queries.</p>
<section id="reduce-data-sets-before-joining-tables">
<h3><a class="toc-backref" href="#id13">Reduce data sets before joining tables</a><a class="headerlink" href="#reduce-data-sets-before-joining-tables" title="Permalink to this heading"></a></h3>
<p>Reducing the input to a <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> clause can increase performance.
Some queries benefit from retreiving a reduced dataset as a subquery prior to a join.</p>
<p>For example,</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">store_name</span><span class="p">,</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">store_dim</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dim</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">store_fact</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dim</span><span class="mf">.</span><span class="n">store_id</span><span class="o">=</span><span class="n">fact</span><span class="mf">.</span><span class="n">store_id</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">p_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2018-07-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2018-07-31&#39;</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Can be rewritten as</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">store_name</span><span class="p">,</span><span class="w"> </span><span class="n">sum_amount</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">store_dim</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dim</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sum_amount</span><span class="p">,</span><span class="w"> </span><span class="n">store_id</span><span class="w"></span>
<span class="w">   </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_fact</span><span class="w"></span>
<span class="w">   </span><span class="k">WHERE</span><span class="w"> </span><span class="n">p_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2018-07-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2018-07-31&#39;</span><span class="w"></span>
<span class="w">   </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">fact</span><span class="w"></span>
<span class="k">ON</span><span class="w"> </span><span class="n">dim</span><span class="mf">.</span><span class="n">store_id</span><span class="o">=</span><span class="n">fact</span><span class="mf">.</span><span class="n">store_id</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="prefer-the-ansi-join">
<h3><a class="toc-backref" href="#id14">Prefer the ANSI JOIN</a><a class="headerlink" href="#prefer-the-ansi-join" title="Permalink to this heading"></a></h3>
<p>SQream DB prefers the ANSI JOIN syntax.
In some cases, the ANSI JOIN performs better than the non-ANSI variety.</p>
<p>For example, this ANSI JOIN example will perform better:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">ANSI JOIN will perform better</span><a class="headerlink" href="#id3" title="Permalink to this code"></a></div>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="mf">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="mf">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="mf">.</span><span class="k">name</span><span class="w"></span>
<span class="k">FROM</span><span class="w">  </span><span class="s s-Name">&quot;Products&quot;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
<span class="k">JOIN</span><span class="w">  </span><span class="s s-Name">&quot;Sales&quot;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w"></span>
<span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">p</span><span class="mf">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="mf">.</span><span class="n">sale_id</span><span class="w"></span>
<span class="k">JOIN</span><span class="w">  </span><span class="s s-Name">&quot;Customers&quot;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">c</span><span class="w"></span>
<span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">s</span><span class="mf">.</span><span class="n">c_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="mf">.</span><span class="n">id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">c</span><span class="mf">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20301125</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>This non-ANSI JOIN is supported, but not recommended:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Non-ANSI JOIN may not perform well</span><a class="headerlink" href="#id4" title="Permalink to this code"></a></div>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="mf">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="mf">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="mf">.</span><span class="k">name</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="s s-Name">&quot;Products&quot;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s s-Name">&quot;Sales&quot;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s s-Name">&quot;Customers&quot;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">c</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">p</span><span class="mf">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="mf">.</span><span class="n">sale_id</span><span class="w"></span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">s</span><span class="mf">.</span><span class="n">c_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="mf">.</span><span class="n">id</span><span class="w"></span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">c</span><span class="mf">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20301125</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="use-the-high-selectivity-hint">
<span id="high-selectivity"></span><h3><a class="toc-backref" href="#id15">Use the high selectivity hint</a><a class="headerlink" href="#use-the-high-selectivity-hint" title="Permalink to this heading"></a></h3>
<p>Selectivity is the ratio of cardinality to the number of records of a chunk. We define selectivity as <span class="math notranslate nohighlight">\(\frac{\text{Distinct values}}{\text{Total number of records in a chunk}}\)</span></p>
<p>SQream DB has a hint function called <code class="docutils literal notranslate"><span class="pre">HIGH_SELECTIVITY</span></code>, which is a function you can wrap a condition in.</p>
<p>The hint signals to SQream DB that the result of the condition will be very sparse, and that it should attempt to rechunk
the results into fewer, fuller chunks.</p>
<p>Use the high selectivity hint when you expect a predicate to filter out most values. For example, when the data is dispersed over lots of chunks (meaning that the data is <span class="xref std std-ref">not well-clustered</span>).</p>
<p>For example,</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">store_name</span><span class="p">,</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_dim</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">HIGH_SELECTIVITY</span><span class="p">(</span><span class="n">p_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2018-07-01&#39;</span><span class="p">)</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>This hint tells the query compiler that the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> condition is expected to filter out more than 60% of values. It never affects the query results, but when used correctly can improve query performance.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code class="docutils literal notranslate"><span class="pre">HIGH_SELECTIVITY()</span></code> hint function can only be used as part of the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause. It can’t be used in equijoin conditions, cases, or in the select list.</p>
</div>
<p>Read more about identifying the scenarios for the high selectivity hint in our <span class="xref std std-ref">Monitoring query performance guide</span>.</p>
</section>
<section id="cast-smaller-types-to-avoid-overflow-in-aggregates">
<h3><a class="toc-backref" href="#id16">Cast smaller types to avoid overflow in aggregates</a><a class="headerlink" href="#cast-smaller-types-to-avoid-overflow-in-aggregates" title="Permalink to this heading"></a></h3>
<p>When using an <code class="docutils literal notranslate"><span class="pre">INT</span></code> or smaller type, the <code class="docutils literal notranslate"><span class="pre">SUM</span></code> and <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> operations return a value of the same type.
To avoid overflow on large results, cast the column up to a larger type.</p>
<p>For example</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">store_name</span><span class="p">,</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">amount</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_dim</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="prefer-count-and-count-on-non-nullable-columns">
<h3><a class="toc-backref" href="#id17">Prefer <code class="docutils literal notranslate"><span class="pre">COUNT(*)</span></code> and <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> on non-nullable columns</a><a class="headerlink" href="#prefer-count-and-count-on-non-nullable-columns" title="Permalink to this heading"></a></h3>
<p>SQream DB optimizes <code class="docutils literal notranslate"><span class="pre">COUNT(*)</span></code> queries very strongly. This also applies to <code class="docutils literal notranslate"><span class="pre">COUNT(column_name)</span></code> on non-nullable columns. Using <code class="docutils literal notranslate"><span class="pre">COUNT(column_name)</span></code> on a nullable column will operate quickly, but much slower than the previous variations.</p>
</section>
<section id="return-only-required-columns">
<h3><a class="toc-backref" href="#id18">Return only required columns</a><a class="headerlink" href="#return-only-required-columns" title="Permalink to this heading"></a></h3>
<p>Returning only the columns you need to client programs can improve overall query performance.
This also reduces the overall result set, which can improve performance in third-party tools.</p>
<p>SQream is able to optimize out unneeded columns very strongly due to its columnar storage.</p>
</section>
<section id="use-saved-queries-to-reduce-recurring-compilation-time">
<h3><a class="toc-backref" href="#id19">Use saved queries to reduce recurring compilation time</a><a class="headerlink" href="#use-saved-queries-to-reduce-recurring-compilation-time" title="Permalink to this heading"></a></h3>
<p><span class="xref std std-ref">saved_queries</span> are compiled when they are created. The query plan is saved in SQream DB’s metadata for later re-use.</p>
<p>Because the query plan is saved, they can be used to reduce compilation overhead, especially with very complex queries, such as queries with lots of values in an <a class="reference internal" href="../reference/sql/sql_functions/scalar_functions/conditionals/in.html#in"><span class="std std-ref">IN</span></a> predicate.</p>
<p>When executed, the saved query plan is recalled and executed on the up-to-date data stored on disk.</p>
<p>See how to use saved queries in the <span class="xref std std-ref">saved queries guide</span>.</p>
</section>
<section id="pre-filter-to-reduce-join-complexity">
<h3><a class="toc-backref" href="#id20">Pre-filter to reduce <a class="reference internal" href="../reference/sql/sql_syntax/joins.html#joins"><span class="std std-ref">JOIN</span></a> complexity</a><a class="headerlink" href="#pre-filter-to-reduce-join-complexity" title="Permalink to this heading"></a></h3>
<p>Filter and reduce table sizes prior to joining on them</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">store_name</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">dimention</span><span class="w"> </span><span class="n">dim</span><span class="w"></span>
<span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dim</span><span class="mf">.</span><span class="n">store_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fact</span><span class="mf">.</span><span class="n">store_id</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">p_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-07-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-07-31&#39;</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">store_name</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Can be rewritten as:</p>
<div class="highlight-postgres notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">store_name</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">sum_amount</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">dimention</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dim</span><span class="w"></span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sum_amount</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="n">store_id</span><span class="w"></span>
<span class="w">              </span><span class="k">FROM</span><span class="w"> </span><span class="n">fact</span><span class="w"></span>
<span class="w">              </span><span class="k">WHERE</span><span class="w"> </span><span class="n">p_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-07-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-07-31&#39;</span><span class="w"></span>
<span class="w">              </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">store_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dim</span><span class="mf">.</span><span class="n">store_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fact</span><span class="mf">.</span><span class="n">store_id</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="data-loading-considerations">
<span id="id2"></span><h2><a class="toc-backref" href="#id21">Data loading considerations</a><a class="headerlink" href="#data-loading-considerations" title="Permalink to this heading"></a></h2>
<section id="allow-and-use-natural-sorting-on-data">
<h3><a class="toc-backref" href="#id22">Allow and use natural sorting on data</a><a class="headerlink" href="#allow-and-use-natural-sorting-on-data" title="Permalink to this heading"></a></h3>
<p>Very often, tabular data is already naturally ordered along a dimension such as a timestamp or area.</p>
<p>This natural order is a major factor for query performance later on, as data that is naturally sorted can be more easily compressed and analyzed with SQream DB’s metadata collection.</p>
<p>For example, when data is sorted by timestamp, filtering on this timestamp is more effective than filtering on an unordered column.</p>
<p>Natural ordering can also be used for effective <a class="reference internal" href="../reference/sql/sql_statements/dml_commands/delete.html#delete"><span class="std std-ref">DELETE</span></a> operations.</p>
</section>
</section>
<section id="further-reading-and-monitoring-query-performance">
<h2><a class="toc-backref" href="#id23">Further reading and monitoring query performance</a><a class="headerlink" href="#further-reading-and-monitoring-query-performance" title="Permalink to this heading"></a></h2>
<p>Read our <a class="reference internal" href="monitoring_query_performance.html#monitoring-query-performance"><span class="std std-ref">Monitoring Query Performance</span></a> guide to learn how to use the built in monitoring utilities.
The guide also gives concerete examples for improving query performance.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="seeing_system_objects_as_ddl.html" class="btn btn-neutral float-left" title="Seeing System Objects as DDL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../configuration_guides/index.html" class="btn btn-neutral float-right" title="Configuration Guides" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 SQream.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>